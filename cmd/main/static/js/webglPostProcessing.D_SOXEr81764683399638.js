import{i as e}from"./ice-utils.DHSeSyjo1764683399638.js";import{P as t}from"./tweakpane.CqZAnw7f1764683399638.js";import{d as n,r,G as o,o as i,I as a,u as f}from"./@vue.DjQnunkc1764683399638.js";import{c as m,o as E,l as _,t as l,s}from"./gl-matrix.XZzMrBim1764683399638.js";var u="attribute vec3 aPosition;\r\nattribute vec2 aTexCoords;\n\nuniform mat4 uProjection;\r\nuniform mat4 uView;\r\nuniform mat4 uModel;\n\nvarying vec2 texCoords;\n\nvoid main()\r\n{\r\n    texCoords=aTexCoords;\r\n    gl_Position=uProjection*uView*uModel*vec4(aPosition,1.);\r\n}",d="precision mediump float;\n\nvarying vec2 texCoords;\n\nuniform sampler2D textureSampler;\n\nvoid main()\r\n{\r\n    gl_FragColor=texture2D(textureSampler,texCoords);\r\n}";const c={id:"canvaswebgl"},T=["src"],R=n({__name:"webglPostProcessing",setup(n){let R,x,A,g,F,b,B,U,v,P,p,y,D;const h=1,C=.71,L=.76,w=new t({title:"参数"}),M=r({hidden:!0,offset_right_top:{x:.5,y:.5},offset_right_bottom:{x:.5,y:.5},offset_left_top:{x:.5,y:.5},offset_left_bottom:{x:.5,y:.5},overlay:{r:1,g:0,b:.33}});w.addBlade({view:"slider",label:"颜色",min:0,max:1,value:.5}).on("change",e=>{X(),x.uniform1f(y,e.value)});let N=new Float32Array([.5,.5,0,1,1,.5,-.5,0,1,0,-.5,-.5,0,0,0,-.5,.5,0,0,1]);w.addBinding(M,"hidden",{label:"是否后处理"}),w.addBinding(M,"offset_right_top",{picker:"inline",x:{min:0,max:1},y:{min:0,max:1}}).on("change",e=>{N[0]=M.offset_right_top.x,N[1]=M.offset_right_top.y,X()}),w.addBinding(M,"offset_right_bottom",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",e=>{N[5]=M.offset_right_bottom.x,N[6]=M.offset_right_bottom.y,X()}),w.addBinding(M,"offset_left_bottom",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",e=>{N[10]=M.offset_left_bottom.x,N[11]=M.offset_left_bottom.y,X()}),w.addBinding(M,"offset_left_top",{picker:"inline",x:{min:-1,max:1},y:{min:-1,max:1}}).on("change",e=>{N[15]=M.offset_left_top.x,N[16]=M.offset_left_top.y,X()});const S=function(){R=document.querySelector("#canvaswebgl"),R.width=window.innerWidth,R.height=window.innerHeight,x=R.getContext("webgl"),x&&(!function(){const t=new Float32Array([.5,.5,0,1,1,.5,-.5,0,1,0,-.5,-.5,0,0,0,-.5,.5,0,0,1]),n=new Uint8Array([0,1,2,0,2,3]);g=O(t,n),A=e(x,u,d),v=x.getUniformLocation(A,"uProjection"),P=x.getUniformLocation(A,"uView"),p=x.getUniformLocation(A,"uModel"),D=Y(document.getElementById("logo-texture"))}(),X(),x.enable(x.BLEND),x.blendFunc(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA),I())};function I(){x.bindFramebuffer(x.FRAMEBUFFER,B),x.clearColor(h,C,L,1),x.clear(x.COLOR_BUFFER_BIT),function(){x.useProgram(A),x.bindBuffer(x.ARRAY_BUFFER,g);const e=m();E(e,0,R.width,R.height,0,.1,100),x.uniformMatrix4fv(v,!1,e);const t=m();_(t,[0,0,1],[0,0,0],[0,1,0]),x.uniformMatrix4fv(P,!1,t),G(D,600,600),G(D,400,400)}(),x.bindFramebuffer(x.FRAMEBUFFER,null),M.hidden&&(x.clear(x.COLOR_BUFFER_BIT),x.clearColor(0,0,1,1),x.bindBuffer(x.ARRAY_BUFFER,F),x.useProgram(b),x.bindTexture(x.TEXTURE_2D,U)),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_BYTE,0),requestAnimationFrame(I)}function G(e,t,n){let r=m();l(r,r,[t,n,0]),s(r,r,[250,250,0]),x.uniformMatrix4fv(p,!1,r),x.bindTexture(x.TEXTURE_2D,e),x.drawElements(x.TRIANGLES,6,x.UNSIGNED_BYTE,0)}function X(){const t=new Uint8Array([0,1,2,0,2,3]);F=O(N,t),b=e(x,"attribute vec3 aPosition;\r\nattribute vec2 aTexCoords;\n\nvarying vec2 texCoords;\n\nvoid main()\r\n{\r\n    texCoords=aTexCoords;\r\n    gl_Position=vec4(aPosition,1.);\r\n}","precision mediump float;\n\nvarying vec2 texCoords;\n\nuniform sampler2D textureSampler;\r\nuniform float mixParam;\r\nvoid main()\r\n{\r\n    \n    vec4 color=mix(texture2D(textureSampler,texCoords),vec4(.1098,.6784,.1843,1.),mixParam);\r\n    gl_FragColor=color;\r\n}"),y=x.getUniformLocation(b,"mixParam"),x.getUniformLocation(b,"color"),U=Y(R),B=x.createFramebuffer(),x.bindFramebuffer(x.FRAMEBUFFER,B),x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,U,0),x.bindFramebuffer(x.FRAMEBUFFER,null)}function Y(e){const t=x.createTexture();return x.bindTexture(x.TEXTURE_2D,t),e instanceof HTMLImageElement?x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,x.RGBA,e.width,e.height,0,x.RGBA,x.UNSIGNED_BYTE,null),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.NEAREST),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),t}function O(e,t){const n=x.createBuffer();x.bindBuffer(x.ARRAY_BUFFER,n),x.bufferData(x.ARRAY_BUFFER,e,x.STATIC_DRAW);const r=3*Float32Array.BYTES_PER_ELEMENT+2*Float32Array.BYTES_PER_ELEMENT;x.vertexAttribPointer(0,3,x.FLOAT,!1,r,0),x.enableVertexAttribArray(0),x.vertexAttribPointer(1,2,x.FLOAT,!1,r,3*Float32Array.BYTES_PER_ELEMENT),x.enableVertexAttribArray(1);const o=x.createBuffer();return x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,o),x.bufferData(x.ELEMENT_ARRAY_BUFFER,t,x.STATIC_DRAW),x.bindBuffer(x.ARRAY_BUFFER,null),n}return(e,t)=>(i(),o("canvas",c,[a("img",{id:"logo-texture",src:f("./")+"./logo.png",style:{display:"none"},onLoad:S},null,40,T)]))}});export{R as default};
