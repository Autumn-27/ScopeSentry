import{r as e,K as r,v as t,T as o}from"./@tresjs.CJvYCGUA1764683399638.js";import{P as a}from"./tweakpane.CqZAnw7f1764683399638.js";import{cG as n,aE as i,d as s,k as l}from"./three.BbguFgn81764683399638.js";import{R as m}from"./Reflector.DiEbG3XV1764683399638.js";import"./index.DM693cYN1764683399638.js";import{d as p,a as f,ad as c,w as u,s as d,a3 as v,G as g,H as j,u as h,o as x,I as y,m as M,r as b,b as C,e as w,f as _,h as S,O as T,ah as k,a9 as G,aa as z}from"./@vue.DjQnunkc1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";import"./@fesjs.CQdxRiFD1764683399638.js";import"./vue-router.CW9J5iK31764683399638.js";import"./lodash-es.DWe8oqPO1764683399638.js";import"./pinia.yp40krTn1764683399638.js";import"./@qlin.y-0Z8WnK1764683399638.js";import"./@babel.BPq7uOAK1764683399638.js";import"./@floating-ui.Bhq4ibgf1764683399638.js";import"./@juggle.Vc7cP4_P1764683399638.js";import"./chalk.BHLFMujs1764683399638.js";/* empty css                                 */import"./iconify-icon.Dg3Wmqac1764683399638.js";import"./@iconify.Db0UMRdG1764683399638.js";import"./vite-plugin-qiankun.B06WoCqG1764683399638.js";import"./dompurify.C4MEnGDh1764683399638.js";import"./color.D_UQSrzA1764683399638.js";import"./color-string.cWrXb_cU1764683399638.js";import"./color-name.gyPnsvCn1764683399638.js";import"./lodash.OvYRBTRe1764683399638.js";import"./@amap.fjyZdsU91764683399638.js";import"./object-hash.C0HZ2EUZ1764683399638.js";import"./jszip.CqykFGTv1764683399638.js";import"./oimophysics.CfVKSiAm1764683399638.js";import"./three-stdlib.CqpxBIJB1764683399638.js";import"./@pmndrs.CRF-_adI1764683399638.js";import"./axios.Bl1IyXmH1764683399638.js";const D={key:0},E=["rotation-x"],B=["object","visible"],R=p({__name:"reflectorDiffuse",props:{mirror:{default:1},mixStrength:{default:10},showGridHelper:{type:Boolean,default:!0},color:{default:"#ffffff"}},async setup(r){let t,o;const a=r,p=new n(9.5,10),b=f(),C=f(),w=f(),_=new m,S={mirror:{value:a.mirror},mixStrength:{value:a.mixStrength}},{textures:T,isLoading:k}=([t,o]=c(()=>e(["./plugins/floor/image/polished_concrete_basecolor.jpg","./plugins/floor/image/polished_concrete_normal.jpg","./plugins/floor/image/polished_concrete_orm.jpg"])),t=await t,o(),t);let G={};u([k,T],([e,r])=>{if(r&&!e){for(var t=0;t<3;t++)r[t].wrapS=i,r[t].wrapT=i,r[t].repeat.set(16,16);G={color:new l("#444"),metalness:1,roughness:1,map:r[0],metalnessMap:r[2],roughnessMap:r[2],aoMap:r[2],aoMapIntensity:1,normalMap:r[1],normalScale:new s(3,3)},d(()=>{b.value.attributes.uv1=b.value.attributes.uv,w.value.aoMap.channel=1,w.value.onBeforeCompile=z,C.value.add(_),C.value.onBeforeRender=(e,r,t)=>{_.update(e,r,t)}})}});const z=e=>{e.uniforms.reflectMap=_.renderTargetUniform,e.uniforms.textureMatrix=_.textureMatrixUniform,e.uniforms=Object.assign(e.uniforms,S),(e=>{e.vertexShader=e.vertexShader.replace("void main() {","\n\t\tuniform mat4 textureMatrix;\n\t\tout vec4 vCoord;\n\t\tout vec3 vToEye;\n\n\t\tvoid main() {\n\t\t"),e.vertexShader=e.vertexShader.replace("#include <project_vertex>","\n\t\t#include <project_vertex>\n\n\t\tvCoord = textureMatrix * vec4(transformed, 1.0);\n\t\tvToEye = cameraPosition - (modelMatrix * vec4(transformed, 1.0)).xyz;\n\t\t")})(e),(e=>{e.fragmentShader=e.fragmentShader.replace("void main() {","\n\t\tuniform sampler2D reflectMap;\n\t\tuniform float mirror;\n\t\tuniform float mixStrength;\n\t\tin vec4 vCoord;\n\t\tin vec3 vToEye;\n\n\t\tvoid main() {\n\t\t"),e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>","\n\t\t#include <emissivemap_fragment>\n\n\t\tvec4 normalColor = texture2D(normalMap, vNormalMapUv * normalScale);\n\t\tvec3 reflectNormal = normalize(vec3(normalColor.r * 2.0 - 1.0, normalColor.b, normalColor.g * 2.0 - 1.0));\n\t\tvec3 reflectCoord = vCoord.xyz / vCoord.w;\n\t\tvec2 reflectUv = reflectCoord.xy + reflectCoord.z * reflectNormal.xz * 0.05;\n\t\tvec4 reflectColor = texture2D(reflectMap, reflectUv);\n\n\t\t// Fresnel term\n\t\tvec3 toEye = normalize(vToEye);\n\t\tfloat theta = max(dot(toEye, normal), 0.0);\n\t\tfloat reflectance = pow((1.0 - theta), 5.0);\n\n\t\treflectColor = mix(vec4(0), reflectColor, reflectance);\n\n\t\tdiffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + reflectColor.rgb * mixStrength);\n\t\t")})(e)};return v(()=>{a.color&&w.value&&(w.value.color=new l(a.color))}),(e,r)=>h(k)?j("",!0):(x(),g("TresGroup",D,[y("TresMesh",{ref_key:"tmRef",ref:C,"rotation-x":-Math.PI/2,"position-y":-.1},[y("TresPlaneGeometry",{ref_key:"tpgRef",ref:b,args:[10,10]},null,512),y("TresMeshStandardMaterial",M({ref_key:"tmsmRef",ref:w},h(G)),null,16)],8,E),y("primitive",{object:h(p),visible:e.showGridHelper},null,8,B)]))}}),H={position:[0,8,0],intensity:10,color:"#fff"},P=p({__name:"reflectorDiffuse",setup(e){const n=b({mirror:.9,mixStrength:9,showGridHelper:!0,color:"#69a5c2"}),i=new a({title:"镜面参数",expanded:!0});return i.addBinding(n,"color",{label:"镜面颜色"}),i.addBinding(n,"showGridHelper",{label:"显示网格"}),(e,a)=>{const i=C("TresCanvas");return x(),w(i,{clearColor:"#201919","window-size":""},{default:_(()=>[a[0]||(a[0]=y("TresPerspectiveCamera",{position:[-15,15,-15],fov:45,near:.1,far:1e4,"look-at":[0,0,0]},null,-1)),S(h(r),{enableDamping:""}),a[1]||(a[1]=y("TresAmbientLight",{intensity:10},null,-1)),T(y("TresDirectionalLight",H,null,512),[[h(t)]]),S(h(o),{args:[1,1,1],color:"orange",position:[3,1,0]}),a[2]||(a[2]=y("TresMesh",{position:[0,2,4]},[y("TresBoxGeometry",{args:[1,1,1]}),y("TresMeshNormalMaterial")],-1)),(x(),w(k,null,{default:_(()=>[S(R,G(z(n)),null,16)]),_:1}))]),_:1})}}});export{P as default};
