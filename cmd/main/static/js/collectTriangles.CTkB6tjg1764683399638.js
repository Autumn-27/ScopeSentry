import{F as e,_ as t,K as s,t as o}from"./@tresjs.CJvYCGUA1764683399638.js";import"./@fesjs.CQdxRiFD1764683399638.js";import"./index.DM693cYN1764683399638.js";import{_ as n}from"./randomLoading.vue_vue_type_script_setup_true_lang.CFA_zQWs1764683399638.js";import{u as r}from"./useLoader.VuwfYjb91764683399638.js";import{m as a,u as i,j as l,bc as p,d as u,M as c,S as m,V as d,i as v,o as g,dO as j}from"./three.BbguFgn81764683399638.js";import{P as h}from"./tweakpane.CqZAnw7f1764683399638.js";import{c as f,d as y,a as b,I as w,C as _,N as x}from"./three-mesh-bvh.DQHx4kOk1764683399638.js";import{d as T,ad as M,a as A,a3 as k,G as C,o as L,F as z,I as B,u as X,r as F,b as O,h as S,f as Y,e as I,m as H,ah as R}from"./@vue.DjQnunkc1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";import"./vue-router.CW9J5iK31764683399638.js";import"./lodash-es.DWe8oqPO1764683399638.js";import"./pinia.yp40krTn1764683399638.js";import"./@qlin.y-0Z8WnK1764683399638.js";import"./@babel.BPq7uOAK1764683399638.js";import"./@floating-ui.Bhq4ibgf1764683399638.js";import"./@juggle.Vc7cP4_P1764683399638.js";import"./chalk.BHLFMujs1764683399638.js";/* empty css                                 */import"./iconify-icon.Dg3Wmqac1764683399638.js";import"./@iconify.Db0UMRdG1764683399638.js";import"./vite-plugin-qiankun.B06WoCqG1764683399638.js";import"./dompurify.C4MEnGDh1764683399638.js";import"./color.D_UQSrzA1764683399638.js";import"./color-string.cWrXb_cU1764683399638.js";import"./color-name.gyPnsvCn1764683399638.js";import"./lodash.OvYRBTRe1764683399638.js";import"./@amap.fjyZdsU91764683399638.js";import"./object-hash.C0HZ2EUZ1764683399638.js";import"./jszip.CqykFGTv1764683399638.js";import"./oimophysics.CfVKSiAm1764683399638.js";import"./three-stdlib.CqpxBIJB1764683399638.js";import"./@pmndrs.CRF-_adI1764683399638.js";import"./axios.Bl1IyXmH1764683399638.js";import"./starLoading.H18GlufF1764683399638.js";import"./cssLoaders.DOXi4-R61764683399638.js";import"./bubbleLoading.BU0KzqvC1764683399638.js";const Z=["geometry","material"],q=["geometry"],E=T({__name:"model",props:{controls:{}},async setup(s){let o,n;const T=s;v.prototype.computeBoundsTree=f,v.prototype.disposeBoundsTree=y,g.prototype.raycast=b;const F=([o,n]=M(()=>r(j,"https://opensource.cdn.icegl.cn/model/industry4/TR12J_OCC.stl")),o=await o,n(),o),O=new i({color:16777215,roughness:.2,metalness:1,vertexColors:!0}),S=new Uint8Array(3*F.attributes.position.count);S.fill(255);const Y=new l(S,3,!0);Y.setUsage(p),F.setAttribute("color",Y);const I=A(null),H=A(null),R=A(!1),E=A(-1),G=A(.2),P=new u,{camera:U}=e(),W=A(new a),J=15/255,K=78/255,N=85/255;let V=null;k(()=>{I.value&&(console.log("targetMesh.value init",I.value),I.value.geometry.computeBoundsTree(),V=F.boundsTree,((e,t,s,o,n,r)=>{window.addEventListener("pointermove",s=>{e.x=s.clientX/window.innerWidth*2-1,e.y=-s.clientY/window.innerHeight*2+1,t.value=!0}),window.addEventListener("pointerdown",i=>{e.x=i.clientX/window.innerWidth*2-1,e.y=-i.clientY/window.innerHeight*2+1,o.value=i.button;const l=new a;l.setFromCamera(e,s.value),l.firstHitOnly=!0;const p=l.intersectObject(n.value,!0);t.value=!0,r.enabled=0===p.length},!0),window.addEventListener("pointerup",e=>{o.value=-1,"touch"===e.pointerType&&(t.value=!1)},!0)})(P,R,U,E,I,T.controls.instance))});const{onBeforeRender:D}=t();D(()=>{const e=F.index;if(H.value)if(T.controls.instance.active||!R.value)H.value.visible=!1;else{H.value.scale.setScalar(G.value),W.value.setFromCamera(P,U.value),W.value.firstHitOnly=!0;const t=W.value.intersectObject(I.value,!0);if(t.length){H.value.position.copy(t[0].point),T.controls.instance.enabled=!1,H.value.visible=!0;const s=new c;s.copy(I.value.matrixWorld).invert();const o=new m;o.center.copy(H.value.position).applyMatrix4(s),o.radius=100*G.value;const n=[],r=new d;if(V?.shapecast({intersectsBounds:e=>{const t=o.intersectsBox(e),{min:s,max:n}=e;if(t){for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let a=0;a<=1;a++)if(r.set(0===e?s.x:n.x,0===t?s.y:n.y,0===a?s.z:n.z),!o.containsPoint(r))return w;return _}return t?w:x},intersectsTriangle:(e,t,s)=>{if(s||e.intersectsSphere(o)){const e=3*t;n.push(e,e+1,e+2)}return!1}}),0===E.value||2===E.value){let t=1,s=1,o=1;0===E.value&&(t=J,s=K,o=N);for(let r=0,a=n.length;r<a;r++){const a=e.getX(n[r]);Y.setX(a,t),Y.setY(a,s),Y.setZ(a,o)}Y.needsUpdate=!0}}else H.value.visible=!1,T.controls.instance.enabled=!0}});const Q=(new h).addButton({title:"点击按钮",label:"生成模型"}),$=new v;return $.setAttribute("position",new l(new Float32Array,0)),Q.on("click",()=>{const e=[],t=[];for(let o=0;o<Y.count;o++)Y.getX(o)===J&&Y.getY(o)===K&&Y.getZ(o)===N&&(e.push(F.attributes.position.getX(o),F.attributes.position.getY(o),F.attributes.position.getZ(o)),t.push(F.attributes.normal.getX(o),F.attributes.normal.getY(o),F.attributes.normal.getZ(o)));const s=new Float32Array(e);$.setAttribute("position",new l(s,3)),$.setAttribute("normal",new l(s,3))}),(e,t)=>(L(),C(z,null,[B("TresMesh",{ref_key:"targetMesh",ref:I,geometry:X(F),scale:.005,material:X(O)},null,8,Z),B("TresMesh",{ref_key:"brushMesh",ref:H,visible:!1},[...t[0]||(t[0]=[B("TresSphereGeometry",{args:[1,40,40]},null,-1),B("TresMeshStandardMaterial",{color:15483002,roughness:.75,metalness:0,transparent:!0,opacity:.5,premultipliedAlpha:!0,emissive:15483002,emissiveIntensity:.5},null,-1)])],512),B("TresMesh",{geometry:X($),position:[-2,-2,2],scale:.005},[...t[1]||(t[1]=[B("TresMeshStandardMaterial",{color:"#023249",roughness:.2,metalness:0,envMapIntensity:.2},null,-1)])],8,q)],64))}}),G=T({__name:"collectTriangles",setup(e){const t=F({clearColor:"#999999",antialias:!0}),r=F({autoRotate:!1}),a=A(null);return(e,i)=>{const l=O("TresCanvas");return L(),C(z,null,[S(X(n)),S(l,H(t,{"window-size":""}),{default:Y(()=>[i[0]||(i[0]=B("TresPerspectiveCamera",{position:[5,1,15],fov:30,near:.1,far:1e3},null,-1)),S(X(s),H({ref_key:"controlsRef",ref:a},r),null,16),i[1]||(i[1]=B("TresAmbientLight",{intensity:1},null,-1)),(L(),I(R,null,{default:Y(()=>[S(E,{controls:a.value},null,8,["controls"])]),_:1})),(L(),I(R,null,{default:Y(()=>[S(X(o),{background:!1,files:["pos-x.jpg","neg-x.jpg","pos-y.jpg","neg-y.jpg","pos-z.jpg","neg-z.jpg"],path:"https://opensource.cdn.icegl.cn/images/skyBox/6jpg/"},null,8,["path"])]),_:1}))]),_:1},16)],64)}}});export{G as default};
