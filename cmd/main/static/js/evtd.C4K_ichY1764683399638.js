function e(e){return e.composedPath()[0]}const t={mousemoveoutside:new WeakMap,clickoutside:new WeakMap};function n(n,o,i){const r=t[n];let u=r.get(o);void 0===u&&r.set(o,u=new WeakMap);let c=u.get(i);return void 0===c&&u.set(i,c=function(t,n,o){if("mousemoveoutside"===t){const t=t=>{n.contains(e(t))||o(t)};return{mousemove:t,touchstart:t}}if("clickoutside"===t){let t=!1;const i=o=>{t=!n.contains(e(o))},r=i=>{t&&(n.contains(e(i))||o(i))};return{mousedown:i,mouseup:r,touchstart:i,touchend:r}}return console.error(`[evtd/create-trap-handler]: name \`${t}\` is invalid. This could be a bug of evtd.`),{}}(n,o,i)),c}function o(e,t,o,i){if("mousemoveoutside"===e||"clickoutside"===e){const u=n(e,t,o);return Object.keys(u).forEach(e=>{r(e,document,u[e],i)}),!0}return!1}function i(e,t,o,i){if("mousemoveoutside"===e||"clickoutside"===e){const r=n(e,t,o);return Object.keys(r).forEach(e=>{u(e,document,r[e],i)}),!0}return!1}const{on:r,off:u}=function(){if("undefined"==typeof window)return{on:()=>{},off:()=>{}};const t=new WeakMap,n=new WeakMap;function r(){t.set(this,!0)}function u(){t.set(this,!0),n.set(this,!0)}function c(e,t,n){const o=e[t];return e[t]=function(){return n.apply(e,arguments),o.apply(e,arguments)},e}function s(e,t){e[t]=Event.prototype[t]}const a=new WeakMap,f=Object.getOwnPropertyDescriptor(Event.prototype,"currentTarget");function d(){var e;return null!==(e=a.get(this))&&void 0!==e?e:null}function p(e,t){void 0!==f&&Object.defineProperty(e,"currentTarget",{configurable:!0,enumerable:!0,get:null!=t?t:f.get})}const l={bubble:{},capture:{}},v={},b=function(){const o=function(o){const{type:i,eventPhase:f,bubbles:v}=o,b=e(o);if(2===f)return;const w=1===f?"capture":"bubble";let h=b;const m=[];for(;null===h&&(h=window),m.push(h),h!==window;)h=h.parentNode||null;const g=l.capture[i],y=l.bubble[i];if(c(o,"stopPropagation",r),c(o,"stopImmediatePropagation",u),p(o,d),"capture"===w){if(void 0===g)return;for(let e=m.length-1;e>=0&&!t.has(o);--e){const t=m[e],i=g.get(t);if(void 0!==i){a.set(o,t);for(const e of i){if(n.has(o))break;e(o)}}if(0===e&&!v&&void 0!==y){const e=y.get(t);if(void 0!==e)for(const t of e){if(n.has(o))break;t(o)}}}}else if("bubble"===w){if(void 0===y)return;for(let e=0;e<m.length&&!t.has(o);++e){const t=m[e],i=y.get(t);if(void 0!==i){a.set(o,t);for(const e of i){if(n.has(o))break;e(o)}}}}s(o,"stopPropagation"),s(o,"stopImmediatePropagation"),p(o)};return o.displayName="evtdUnifiedHandler",o}(),w=function(){const e=function(e){const{type:t,eventPhase:n}=e;if(2!==n)return;const o=v[t];void 0!==o&&o.forEach(t=>t(e))};return e.displayName="evtdUnifiedWindowEventHandler",e}();function h(e,t){const n=l[e];return void 0===n[t]&&(n[t]=new Map,window.addEventListener(t,b,"capture"===e)),n[t]}function m(e,t){let n=e.get(t);return void 0===n&&e.set(t,n=new Set),n}function g(e,t,n,o){if(i(e,t,n,o))return;const r=!0===o||"object"==typeof o&&!0===o.capture,u=r?"capture":"bubble",c=h(u,e),s=m(c,t);if(t===window){if(!function(e,t,n,o){const i=l[t][n];if(void 0!==i){const t=i.get(e);if(void 0!==t&&t.has(o))return!0}return!1}(t,r?"bubble":"capture",e,n)&&function(e,t){const n=v[e];return!(void 0===n||!n.has(t))}(e,n)){const t=v[e];t.delete(n),0===t.size&&(window.removeEventListener(e,w),v[e]=void 0)}}s.has(n)&&s.delete(n),0===s.size&&c.delete(t),0===c.size&&(window.removeEventListener(e,b,"capture"===u),l[u][e]=void 0)}return{on:function(e,t,n,i){let r;if(r="object"==typeof i&&!0===i.once?o=>{g(e,t,r,i),n(o)}:n,o(e,t,r,i))return;const u=m(h(!0===i||"object"==typeof i&&!0===i.capture?"capture":"bubble",e),t);if(u.has(r)||u.add(r),t===window){const t=function(e){return void 0===v[e]&&(v[e]=new Set,window.addEventListener(e,w)),v[e]}(e);t.has(r)||t.add(r)}},off:g}}();export{u as a,r as o};
