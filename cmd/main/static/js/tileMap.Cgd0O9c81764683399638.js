import{P as e}from"./tweakpane.CqZAnw7f1764683399638.js";import{i as t,j as o,k as r,g as s,V as i,dP as n,ad as a,A as p}from"./three.BbguFgn81764683399638.js";import{F as m,_ as l}from"./@tresjs.CJvYCGUA1764683399638.js";import{U as u,P as c,M as h,a as d,b as g,T as j,c as f,l as w,r as b}from"./raycasterEvent.CulMKG-f1764683399638.js";import"./Fetch.CIMEiaKn1764683399638.js";import{d as x,a3 as k,w as y,G as v,o as M,u as _,t as B,r as C,b as W,h as I,f as T,m as z,F as S}from"./@vue.DjQnunkc1764683399638.js";import"./three-custom-shader-material.VhylcSiy1764683399638.js";import{c as Z}from"./utils.DJFfMxDw1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";import"./@mapbox.DBNDgF_h1764683399638.js";import"./three-mesh-bvh.DQHx4kOk1764683399638.js";import"./@fesjs.CQdxRiFD1764683399638.js";import"./vue-router.CW9J5iK31764683399638.js";import"./lodash-es.DWe8oqPO1764683399638.js";import"./pinia.yp40krTn1764683399638.js";import"./@qlin.y-0Z8WnK1764683399638.js";import"./@babel.BPq7uOAK1764683399638.js";import"./@floating-ui.Bhq4ibgf1764683399638.js";import"./@juggle.Vc7cP4_P1764683399638.js";import"./@tweenjs.C9YEcV0Y1764683399638.js";import"./utils.e6kO7tRf1764683399638.js";import"./index.DM693cYN1764683399638.js";import"./chalk.BHLFMujs1764683399638.js";/* empty css                                 */import"./iconify-icon.Dg3Wmqac1764683399638.js";import"./@iconify.Db0UMRdG1764683399638.js";import"./vite-plugin-qiankun.B06WoCqG1764683399638.js";import"./dompurify.C4MEnGDh1764683399638.js";import"./color.D_UQSrzA1764683399638.js";import"./color-string.cWrXb_cU1764683399638.js";import"./color-name.gyPnsvCn1764683399638.js";import"./lodash.OvYRBTRe1764683399638.js";import"./@amap.fjyZdsU91764683399638.js";import"./object-hash.C0HZ2EUZ1764683399638.js";import"./jszip.CqykFGTv1764683399638.js";import"./oimophysics.CfVKSiAm1764683399638.js";import"./three-stdlib.CqpxBIJB1764683399638.js";import"./@pmndrs.CRF-_adI1764683399638.js";import"./axios.Bl1IyXmH1764683399638.js";import"./useTexture.RJnyBWqC1764683399638.js";import"./d3-geo.C51lZA-81764683399638.js";function A(e){return new Worker(""+new URL("../static/MartiniWorker-Ryjx9cZO.js",import.meta.url).href,{name:e?.name})}class R{constructor(){this.maxZoom=12,this.coordType=u,this.utmZone=50,this._useWorker=!0,this.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp"}set useWorker(e){this._useWorker=e,this._useWorker||(this._worker?.terminate(),this._worker=void 0)}get useWorker(){return this._useWorker}async getTile(e){return this._useWorker?this.getInWorkerThread(e):this.getInMainThread()}async getInMainThread(){return new t}async getInWorkerThread(e){this._worker||(this._worker=new c(A));const r={tileNo:e,id:this.getId(e),url:this.getUrl(e),maxZ:this.maxZoom,coordType:this.coordType,utmZone:this.utmZone},s=await this._worker.postMessage(r),i=new t;return i.setAttribute("position",new o(s.positions,3)),i.setAttribute("uv",new o(s.uv,2)),i.setIndex(new o(s.triangles,1)),i}async abort(e){this._useWorker&&this._worker?.postMessage({id:this.getId(e),abort:!0})}async dispose(e,t){t.dispose(),this._useWorker&&this._worker?.postMessage({id:this.getId(e),dispose:!0})}getId(e){return e.join("-")}getUrl(e){const[t,o,r]=e;return this.source.replace("[x]",t+"").replace("[y]",o+"").replace("[z]",r+"")}}const L=["object","rotation"],P=x({__name:"tileMapMesh",props:{bbox:{default:[104.955976,20.149765,120.998419,30.528687]},maxZoom:{default:20},opposite:{type:Boolean,default:!1},genBright:{default:1},genContrast:{default:1},genSaturation:{default:1},monochrome:{default:"#fff"},isMonochrome:{type:Boolean,default:!1},mapCenter:{},tweenInstance:{default:null}},setup(e,{expose:t}){const o=e,{renderer:a,scene:p}=m(),u=new d;u.coordType=h;const c=new R;c.source="https://api.maptiler.com/tiles/terrain-rgb-v2/[z]/[x]/[y].webp?key=L55MtSxL94Yb4hQeWewp",c.coordType=h;const w=new g;w.source="https://webrd04.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=7&x={x}&y={y}&z={z}",w.showTileNo=!1,w.useWorker=!0;const b=new j(u,w);if(b.showBoundingBox=!1,b.wireframe=!1,b.flatShading=!1,b.useStandardMaterial=!1,b.filter={opposite:o.opposite,monochrome:o.isMonochrome?{r:.299,g:.587,b:.114}:null,genBright:o.genBright,genContrast:o.genContrast,genSaturation:o.genSaturation},o.monochrome){let e=new r(o.monochrome);b.filter&&(b.filter.monochrome={r:e.r,g:e.g,b:e.b})}const x=new f;x.provider=b,x.bbox=o.bbox,x.maxZoom=o.maxZoom;const B=new s(60,window.innerWidth/window.innerHeight,1,1e8);B.up=new i(0,1,0),B.position.set(o.mapCenter[0],o.mapCenter[2],-o.mapCenter[1]),B.lookAt(new i(B.position.x,0,B.position.z-2e3)),x.camera=B;let C=null;k(()=>{a&&!C&&(C=new n(B,a.domElement),C.enableDamping=!0,C.dampingFactor=.05,C.minDistance=600,C.position0.set(B.position.x,B.position.y,B.position.z),C.target.set(B.position.x,0,B.position.z-2e3))}),y(()=>[o.opposite,o.isMonochrome,o.monochrome],([e,t,o])=>{if(b.filter){let s=new r(o);b.filter.opposite=e,b.filter.monochrome=t?{r:s.r,g:s.g,b:s.b}:null}}),y(()=>[o.genBright,o.genContrast,o.genSaturation],([e,t,o])=>{b.filter&&(b.filter.genBright=e,b.filter.genContrast=t,b.filter.genSaturation=o)});const{onBeforeRender:W}=l();return W(()=>{if(a){o.tweenInstance?.update(),C&&C.update(),x.update();const e=50*Math.abs(B.position.y);B.far=e+5e3,B.updateProjectionMatrix(),a.render(p.value,B)}}),t({camera:B,map:x,orbitControl:C}),(e,t)=>(M(),v("primitive",{object:_(x),rotation:[-Math.PI/2,0,0]},null,8,L))}}),D=x({__name:"tileMap",setup(t){const o=w(118.779958,32.017136),r=[o[0],o[1],5e3],s=B(),n=C({opposite:!0,genBright:1.3,genContrast:1,genSaturation:1,isMonochrome:!0,monochrome:"#4688b5",mapCenter:r,tweenInstance:null}),m=new e({title:"参数"});m.addBinding(n,"opposite",{label:"反色"}),m.addBinding(n,"genBright",{label:"高亮",min:.1,max:3,step:.1}),m.addBinding(n,"genContrast",{label:"对比度",min:.1,max:3,step:.1}),m.addBinding(n,"genSaturation",{label:"饱和度",min:.1,max:3,step:.1}),m.addBinding(n,"isMonochrome",{label:"单色滤镜"}),m.addBinding(n,"monochrome",{label:"滤镜颜色"});const l={at:w(118.7425,31.9998),xjk:w(118.7842,32.0418),nss:w(118.7503,31.9082)};m.addBlade({view:"list",label:"飞去",options:[{text:"奥体中心",value:"at"},{text:"新街口",value:"xjk"},{text:"牛首山",value:"nss"}],value:"at"}).on("change",e=>{const t=new i(l[e.value][0],2e3,-l[e.value][1]);n.tweenInstance=Z(s.value.camera,t,s.value.orbitControl,[0,-300],4e3)});const u=C({clearColor:"#201919",antialias:!0,logarithmicDepthBuffer:!0,renderMode:"manual",outputColorSpace:p,toneMapping:a});return setTimeout(()=>{const e=l.at,t=new i(e[0],1600,-e[1]);n.tweenInstance=Z(s.value.camera,t,s.value.orbitControl,[-2e3,-2e3],2e3)},1e3),(e,t)=>{const o=W("TresCanvas");return M(),v(S,null,[I(o,z(u,{"window-size":""}),{default:T(()=>[I(P,z(n,{ref_key:"tileMapMeshRef",ref:s,bbox:[80,16,128,50]}),null,16)]),_:1},16),I(b,{tileMapRef:s.value},null,8,["tileMapRef"])],64)}}});export{D as default};
