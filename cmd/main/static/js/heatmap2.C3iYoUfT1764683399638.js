import{P as t}from"./tweakpane.CqZAnw7f1764683399638.js";import{a as e,b as o,l as a}from"./pagesShow.vue_vue_type_script_setup_true_lang.BJJ2kmGn1764683399638.js";import{h as s}from"./heatmap.js-fix.CVXWBZXX1764683399638.js";import{b as i,z as r,cL as n,M as p,o as m,i as l,q as u,a6 as c}from"./three.BbguFgn81764683399638.js";import{r as d}from"./utils.e6kO7tRf1764683399638.js";import{d as v}from"./pinia.yp40krTn1764683399638.js";import{a as h,d as j,a3 as y,G as g,o as f,F as b,I as x,u as w,q as _,V as M,O as D,Q as I,M as P,N as T,ad as S,r as k,h as q,f as B,m as O}from"./@vue.DjQnunkc1764683399638.js";import{c as U,d as z,a as A}from"./three-mesh-bvh.DQHx4kOk1764683399638.js";import{_ as C}from"./@fesjs.CQdxRiFD1764683399638.js";import"./@tresjs.CJvYCGUA1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";import"./index.DM693cYN1764683399638.js";import"./chalk.BHLFMujs1764683399638.js";/* empty css                                 */import"./iconify-icon.Dg3Wmqac1764683399638.js";import"./@iconify.Db0UMRdG1764683399638.js";import"./vite-plugin-qiankun.B06WoCqG1764683399638.js";import"./vue-router.CW9J5iK31764683399638.js";import"./dompurify.C4MEnGDh1764683399638.js";import"./color.D_UQSrzA1764683399638.js";import"./color-string.cWrXb_cU1764683399638.js";import"./color-name.gyPnsvCn1764683399638.js";import"./lodash.OvYRBTRe1764683399638.js";import"./@amap.fjyZdsU91764683399638.js";import"./object-hash.C0HZ2EUZ1764683399638.js";import"./jszip.CqykFGTv1764683399638.js";import"./oimophysics.CfVKSiAm1764683399638.js";import"./three-stdlib.CqpxBIJB1764683399638.js";import"./@pmndrs.CRF-_adI1764683399638.js";import"./axios.Bl1IyXmH1764683399638.js";import"./three-custom-shader-material.VhylcSiy1764683399638.js";import"./buildingsCustomShaderMaterial.C_BZxytV1764683399638.js";import"./useTexture.RJnyBWqC1764683399638.js";import"./lodash-es.DWe8oqPO1764683399638.js";import"./@qlin.y-0Z8WnK1764683399638.js";import"./@babel.BPq7uOAK1764683399638.js";import"./@floating-ui.Bhq4ibgf1764683399638.js";import"./@juggle.Vc7cP4_P1764683399638.js";const E=(t,e)=>t.getValueAt(e)+-10,L=v("buildingsHeatmap",()=>{const t=h(!1),e=h(0);return{showDiv:t,temperature:e,setShowDiv:function(e){t.value=e},setTemperature:function(t){e.value=t}}}),V=["object","rotation-x"],F=["object"],G=j({__name:"buildingsHeatmap",props:{model:{},opacity:{default:1}},setup(t){l.prototype.computeBoundsTree=U,l.prototype.disposeBoundsTree=z,m.prototype.raycast=A;const e=t,o=((t=250,e=250,o=!0)=>{const a=document.createElement("heatmap-canvas");return a.style.position="absolute",o||(a.style.display="none"),a.style.top="0",a.style.left="0",document.body.appendChild(a),s.create({container:a,width:t,height:e,blur:".8",radius:10,gradient:{.25:"rgb(0,0,255)",.55:"rgb(0,255,0)",.85:"yellow",1:"rgb(255,0,0)"}})})();((t,e)=>{if(!e){let o=0;for(e=[];o<1e3;)e.push({x:i.randInt(1,t._config.width),y:i.randInt(1,t._config.height),value:i.randInt(-10,36)}),o++}t.setData({max:36,min:-10,data:e})})(o);const a=new r(o._renderer.canvas);a.needsUpdate=!0;const v=e.model.city.clone();delete v.geometry.attributes.normal,delete v.geometry.attributes.uv;const h=v.geometry.clone().applyMatrix4(v.matrix),j=e.model.land.clone();delete j.geometry.attributes.normal;const _=j.geometry.clone().applyMatrix4(j.matrix),M=n([h,_]);M.applyMatrix4((new p).makeRotationX(Math.PI/2)),d(M),M.computeBoundsTree();const D=(I=a,new u({vertexShader:"\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n\t\t\tvUv = uv;\n\t\t}\n\t\t",fragmentShader:"\n\t\tuniform sampler2D heightMap;\n\t\tuniform float uOpacity;\n\t\tvarying vec2 vUv;\n\t\tvoid main() {\n\t\t\tgl_FragColor = vec4(texture2D(heightMap, vUv.xy).rgb, uOpacity);\n    }\n\t\t",uniforms:{uOpacity:{value:e.opacity},heightMap:{type:"t",value:I}},depthWrite:!0,depthTest:!0,transparent:!0,side:c}));var I;const P=new m(M,D);y(()=>{e.opacity&&(D.uniforms.uOpacity.value=e.opacity)});const T=L(),S=t=>{if(t){const e={x:t.uv.x*o._config.width,y:(1-t.uv.y)*o._config.height};console.log("数值：",t),console.log("数值———：",E(o,e)),T.setTemperature(E(o,e))}},k=t=>{t&&T.$patch({showDiv:!0})},q=t=>{t&&T.setShowDiv(!1)};return(t,o)=>(f(),g(b,null,[x("primitive",{object:w(P),"rotation-x":-Math.PI/2,onPointermove:S,onPointerenter:k,onPointerleave:q},null,40,V),x("primitive",{object:e.model.model.children[0].clone()},null,8,F)],64))}}),H=C({__name:"dataDiv",setup(t){const e=L(),o=h({top:0,left:0});function a(t){o.value.left=t.clientX+5+"px",o.value.top=t.clientY-20+"px"}return _(()=>{window.addEventListener("mousemove",a)}),M(()=>{window.removeEventListener("mousemove",a)}),(t,a)=>D((f(),g("div",{class:"title",style:T(o.value)},"温度："+P(w(e).temperature)+"℃ ",5)),[[I,w(e).showDiv]])}},[["__scopeId","data-v-4dce8491"]]),R=j({__name:"heatmap2",async setup(s){let i,r;const n=h(!1),p=([i,r]=S(()=>a()),i=await i,r(),i);n.value=!0;const m=k({width:1,color:"#000",opacity:1,show:!0}),l=k({opacity:.9});return new t({title:"参数",expanded:!0}).addBinding(l,"opacity",{label:"透明度",min:0,max:1,step:.1}),(t,a)=>(f(),g(b,null,[q(o,{showBuildings:!1,autoRotate:!1},{ability:B(()=>[q(G,O({model:w(p)},l),null,16,["model"]),q(e,O(m,{builds:w(p).city}),null,16,["builds"])]),_:1}),q(H)],64))}});export{R as default};
