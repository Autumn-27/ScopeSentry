import{P as t}from"./tweakpane.CqZAnw7f1764683399638.js";import{b as i}from"./pagesShow.vue_vue_type_script_setup_true_lang.BJJ2kmGn1764683399638.js";import{r as e,_ as s}from"./@tresjs.CJvYCGUA1764683399638.js";import{q as r,af as a,ag as o,d as n,k as u,i as h,M as l,V as p,j as f,R as c,S as d,an as m,aE as v,bA as y,bJ as g,aV as b}from"./three.BbguFgn81764683399638.js";import{d as x,w,G as _,o as A,u as j,r as P,e as M,f as W,h as C,m as z}from"./@vue.DjQnunkc1764683399638.js";import"./index.DM693cYN1764683399638.js";import"./@fesjs.CQdxRiFD1764683399638.js";import"./vue-router.CW9J5iK31764683399638.js";import"./lodash-es.DWe8oqPO1764683399638.js";import"./pinia.yp40krTn1764683399638.js";import"./@qlin.y-0Z8WnK1764683399638.js";import"./@babel.BPq7uOAK1764683399638.js";import"./@floating-ui.Bhq4ibgf1764683399638.js";import"./@juggle.Vc7cP4_P1764683399638.js";import"./chalk.BHLFMujs1764683399638.js";/* empty css                                 */import"./iconify-icon.Dg3Wmqac1764683399638.js";import"./@iconify.Db0UMRdG1764683399638.js";import"./vite-plugin-qiankun.B06WoCqG1764683399638.js";import"./dompurify.C4MEnGDh1764683399638.js";import"./color.D_UQSrzA1764683399638.js";import"./color-string.cWrXb_cU1764683399638.js";import"./color-name.gyPnsvCn1764683399638.js";import"./lodash.OvYRBTRe1764683399638.js";import"./@amap.fjyZdsU91764683399638.js";import"./object-hash.C0HZ2EUZ1764683399638.js";import"./jszip.CqykFGTv1764683399638.js";import"./oimophysics.CfVKSiAm1764683399638.js";import"./three-stdlib.CqpxBIJB1764683399638.js";import"./@pmndrs.CRF-_adI1764683399638.js";import"./axios.Bl1IyXmH1764683399638.js";import"./three-custom-shader-material.VhylcSiy1764683399638.js";import"./buildingsCustomShaderMaterial.C_BZxytV1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";class F extends h{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new l,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(t){this.setPoints(t,this.widthCallback)}}})}}function V(t,i,e,s,r){var a;if(t=t.subarray||t.slice?t:t.buffer,e=e.subarray||e.slice?e:e.buffer,t=i?t.subarray?t.subarray(i,r&&i+r):t.slice(i,r&&i+r):t,e.set)e.set(t,s);else for(a=0;a<t.length;a++)e[a+s]=t[a];return e}F.prototype.setMatrixWorld=function(t){this.matrixWorld=t},F.prototype.setGeometry=function(t,i){this._geometry=t,this.setPoints(t.getAttribute("position").array,i)},F.prototype.setPoints=function(t,i){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.widthCallback=i,this.positions=[],this.counters=[],t.length&&t[0]instanceof p)for(var e=0;e<t.length;e++){var s=t[e],r=e/t.length;this.positions.push(s.x,s.y,s.z),this.positions.push(s.x,s.y,s.z),this.counters.push(r),this.counters.push(r)}else for(e=0;e<t.length;e+=3){r=e/t.length;this.positions.push(t[e],t[e+1],t[e+2]),this.positions.push(t[e],t[e+1],t[e+2]),this.counters.push(r),this.counters.push(r)}this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},F.prototype.raycast=function(t,i){var e=new l,s=new c,r=new d,a=new p,o=this.geometry;if(o.boundingSphere||o.computeBoundingSphere(),r.copy(o.boundingSphere),r.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(r,a)){e.copy(this.matrixWorld).invert(),s.copy(t.ray).applyMatrix4(e);var n=new p,u=new p,h=new p,f=this instanceof m?2:1,v=o.index,y=o.attributes;if(null!==v)for(var g=v.array,b=y.position.array,x=y.width.array,w=0,_=g.length-1;w<_;w+=f){var A=g[w],j=g[w+1];n.fromArray(b,3*A),u.fromArray(b,3*j);var P=void 0!==x[Math.floor(w/3)]?x[Math.floor(w/3)]:1,M=t.params.Line.threshold+this.material.lineWidth*P/2,W=M*M;if(!(s.distanceSqToSegment(n,u,a,h)>W)){a.applyMatrix4(this.matrixWorld);var C=t.ray.origin.distanceTo(a);C<t.near||C>t.far||(i.push({distance:C,point:h.clone().applyMatrix4(this.matrixWorld),index:w,face:null,faceIndex:null,object:this}),w=_)}}}},F.prototype.compareV3=function(t,i){var e=6*t,s=6*i;return this.positions[e]===this.positions[s]&&this.positions[e+1]===this.positions[s+1]&&this.positions[e+2]===this.positions[s+2]},F.prototype.copyV3=function(t){var i=6*t;return[this.positions[i],this.positions[i+1],this.positions[i+2]]},F.prototype.process=function(){var t,i,e=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],i=this.compareV3(0,e-1)?this.copyV3(e-2):this.copyV3(0),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);for(var s=0;s<e;s++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(s/(e-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(s/(e-1),0),this.uvs.push(s/(e-1),1),s<e-1){i=this.copyV3(s),this.previous.push(i[0],i[1],i[2]),this.previous.push(i[0],i[1],i[2]);var r=2*s;this.indices_array.push(r,r+1,r+2),this.indices_array.push(r+2,r+1,r+3)}s>0&&(i=this.copyV3(s),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]))}i=this.compareV3(e-1,0)?this.copyV3(1):this.copyV3(e-1),this.next.push(i[0],i[1],i[2]),this.next.push(i[0],i[1],i[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new f(new Float32Array(this.positions),3),previous:new f(new Float32Array(this.previous),3),next:new f(new Float32Array(this.next),3),side:new f(new Float32Array(this.side),1),width:new f(new Float32Array(this.width),1),uv:new f(new Float32Array(this.uvs),2),index:new f(new Uint16Array(this.indices_array),1),counters:new f(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox(),this._geometry.attributes=this.attributes,this._geometry.index=this.index,this._geometry.computeBoundingSphere(),this._geometry.computeBoundingBox()},F.prototype.advance=function(t){var i=this._attributes.position.array,e=this._attributes.previous.array,s=this._attributes.next.array,r=i.length;V(i,0,e,0,r),V(i,6,i,0,r-6),i[r-6]=t.x,i[r-5]=t.y,i[r-4]=t.z,i[r-3]=t.x,i[r-2]=t.y,i[r-1]=t.z,V(i,6,s,0,r-6),s[r-6]=t.x,s[r-5]=t.y,s[r-4]=t.z,s[r-3]=t.x,s[r-2]=t.y,s[r-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},a.meshline_vert=["",a.logdepthbuf_pars_vertex,a.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","uniform vec2 offset;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color, opacity );","    vUV = uv + offset;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = 1.8 * lineWidth * width;","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","    gl_Position = finalPosition;","",a.logdepthbuf_vertex,a.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",a.fog_vertex,"}"].join("\r\n"),a.meshline_frag=["",a.fog_pars_fragment,a.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",a.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",a.fog_fragment,"}"].join("\r\n");class U extends r{constructor(t){super({uniforms:Object.assign({},o.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new u(16777215)},opacity:{value:1},resolution:{value:new n(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new n(1,1)},offset:{value:new n(1,1)}}),vertexShader:a.meshline_vert,fragmentShader:a.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}},offset:{enumerable:!0,get:function(){return this.uniforms.offset.value},set:function(t){this.uniforms.offset.value.copy(t)}}}),this.setValues(t)}}U.prototype.copy=function(t){return r.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this};const R=["geometry","material"],S=x({__name:"arrowFlyLine",props:{linePoints:{default:[[500,0,500],[0,0,0]]},speed:{default:.01},style:{default:1},color:{default:"#fff"},opacity:{default:1},height:{default:330},lineWidth:{default:40}},setup(t){const i=t,{textures:r,isLoading:a}=e(["./plugins/digitalCity/image/flyLine1.png","./plugins/digitalCity/image/flyLine2.png","./plugins/digitalCity/image/flyLine3.png","./plugins/digitalCity/image/flyLine4.png","./plugins/digitalCity/image/flyLine5.png"]);w([r,a],([t,e])=>{t&&!e&&(t.forEach(t=>{t.anisotropy=16,t.wrapS=v,t.wrapT=v}),d.map=t[i.style])});const o=(i.linePoints[1][0]+i.linePoints[0][0])/2,u=(i.linePoints[1][2]+i.linePoints[0][2])/2,l=new y((new p).fromArray(i.linePoints[0]),new p(o,i.height,u),new p(o,i.height,u),(new p).fromArray(i.linePoints[1])),f=new h;f.setFromPoints(l.getPoints(100));const c=new F;c.setGeometry(f);const d=new U({color:i.color,map:null,useMap:!0,lineWidth:i.lineWidth,resolution:new n(100,100),dashArray:0,dashRatio:.7,dashOffset:1,transparent:!0,sizeAttenuation:1,side:b,depthTest:!1,blending:g,opacity:i.opacity});d.depthWrite=!1,d.depthTest=!0;const{onBeforeRender:m}=s();return m(()=>{d.uniforms.offset.value.x-=i.speed}),w(()=>[i.color,i.opacity,i.lineWidth],([t,i,e])=>{d.uniforms.color.value.setStyle(t),d.uniforms.opacity.value=i,d.uniforms.lineWidth.value=e}),(t,i)=>(A(),_("TresMesh",{geometry:j(c)._geometry,material:j(d),"render-order":99999},null,8,R))}}),T=x({__name:"flyLines",setup(e){const s=P({color:"#FFF",speed:.01,opacity:1,lineWidth:40}),r=new t({title:"效果参数",expanded:!0});return r.addBinding(s,"color",{label:"线颜色"}),r.addBinding(s,"speed",{label:"速度",min:.001,max:.05,step:.001}),r.addBinding(s,"opacity",{label:"透明度",min:0,max:1,step:.01}),r.addBinding(s,"lineWidth",{label:"线宽度",min:10,max:200,step:1}),(t,e)=>(A(),M(i,null,{ability:W(()=>[C(S,z(s,{linePoints:[[500,20,500],[0,20,0]]}),null,16),C(S,{style:0,linePoints:[[-500,20,-500],[0,20,0]]}),C(S,{style:2,linePoints:[[500,20,-500],[0,20,0]]}),C(S,{style:3,linePoints:[[-500,20,500],[0,20,0]],opacity:.8,lineWidth:10}),C(S,{style:4,linePoints:[[200,60,600],[0,20,0]]})]),_:1}))}});export{T as default};
