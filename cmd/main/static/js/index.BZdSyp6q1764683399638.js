import{G as e,dx as a,ad as t,A as l,d7 as s}from"./three.BbguFgn81764683399638.js";import{K as o,y as r,a4 as i,d as n}from"./@tresjs.CJvYCGUA1764683399638.js";import{d as c}from"./pinia.yp40krTn1764683399638.js";import{a as u,d as m,c as d,e as p,o as f,m as v,u as y,g as h,w as g,G as w,H as j,I as b,h as x,ad as k,f as _,M as S,v as M,F as B,R as C,r as T,a3 as P}from"./@vue.DjQnunkc1764683399638.js";import{P as z}from"./tweakpane.CqZAnw7f1764683399638.js";import{_ as A}from"./@fesjs.CQdxRiFD1764683399638.js";import{u as L,o as D,p as O,c as R,B as U,q as G,r as I,b as N,N as E,s as F,t as H,m as J,v as q}from"./naive-ui.B3U9nW8I1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";import"./vue-router.CW9J5iK31764683399638.js";import"./lodash-es.DWe8oqPO1764683399638.js";import"./@qlin.y-0Z8WnK1764683399638.js";import"./@babel.BPq7uOAK1764683399638.js";import"./@floating-ui.Bhq4ibgf1764683399638.js";import"./@juggle.Vc7cP4_P1764683399638.js";import"./date-fns.eh-WGDI81764683399638.js";import"./@css-render.xqIdICM01764683399638.js";import"./css-render.C5auSBy-1764683399638.js";import"./@emotion.DFFAhID71764683399638.js";import"./seemly.D2hUckm91764683399638.js";import"./vooks.Bo4F44h01764683399638.js";import"./evtd.C4K_ichY1764683399638.js";import"./vueuc.CRwbGw8l1764683399638.js";import"./vdirs.T0yx3CKS1764683399638.js";import"./treemate.Qc8YxXqZ1764683399638.js";import"./date-fns-tz.C_a0YZvl1764683399638.js";import"./async-validator.DJtlKCAR1764683399638.js";const $=c("materialDiyStore",()=>{const e=u("MeshBasicMaterial");return{curState:u({}),curType:e,curModelArrayBuffer:u(null)}}),K=m({__name:"materialDiy",setup(e){const a=$(),t=d(()=>`Tres${a.curType}`);return(e,l)=>(f(),p(h(t.value),v(y(a).curState,{transparent:"",flatShading:""}),null,16))}});const Q={key:0,scale:.5},V=["position","rotation","scale","geometry"],W=m({__name:"model",setup(t){const l=u(null),s=$();return g(()=>s.curModelArrayBuffer,async t=>{if(t){const s=await async function(t){const l=new e,s=new a;return s.setDecoderPath("./draco/"),l.setDRACOLoader(s),new Promise((e,a)=>{l.parse(t,"",a=>{e(a)},e=>{console.error("GLB 加载失败:",e),a(e)})})}(t);l.value=s.scene.children[0].children[0]}else l.value=null},{immediate:!0}),(e,a)=>l.value?(f(),w("TresGroup",Q,[b("TresMesh",{position:l.value.position,rotation:l.value.rotation,scale:l.value.scale,geometry:l.value.geometry,"cast-shadow":""},[x(K)],8,V)])):j("",!0)}}),X={MeshBasicMaterial:{default:{color:"#161cff",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshLambertMaterial:{default:{color:"#3ef561",wireframe:!1,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},wireframe:{name:"线框",com:"Switch"},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}},MeshPhysicalMaterial:{default:{color:"#e75ff5",metalness:.45,roughness:.36,transmission:.33,reflectivity:.5,ior:1.5,opacity:1},config:{color:{name:"颜色",com:"ColorPicker"},metalness:{name:"金属度",com:"Slider",min:0,max:1,step:.01},roughness:{name:"粗糙度",com:"Slider",min:0,max:1,step:.01},reflectivity:{name:"反射率",com:"Slider",min:0,max:1,step:.01},ior:{name:"折射率",com:"Slider",min:1,max:2.33,step:.01},transmission:{name:"透光率",com:"Slider",min:0,max:1,step:.01},opacity:{name:"透明度",com:"Slider",min:0,max:1,step:.01}}}},Y=m({__name:"setupUI",setup(e){const a=$(),t=new z({title:"参数",expanded:!0}),l=Object.keys(X),s=[];l.forEach(e=>{s.push({text:e,value:e})}),t.addBlade({view:"list",label:"材质类型",options:s,value:l[2]}).on("change",e=>{r(e.value)});let o=null;const r=e=>{const l=X[e];a.curType=e,a.curState=JSON.parse(JSON.stringify(l.default)),o&&o.dispose(),o=t.addFolder({title:"材质属性"}),Object.keys(l.config).forEach(e=>{"ColorPicker"===l.config[e].com||"Switch"===l.config[e].com?o.addBinding(a.curState,e,{label:l.config[e].name}):"Slider"===l.config[e].com&&o.addBinding(a.curState,e,{label:l.config[e].name,min:l.config[e].min,max:l.config[e].max,step:l.config[e].step})})};return r(l[2]),(e,a)=>null}}),Z={key:0,class:"upload-mask"},ee={class:"upload-mask-content"},ae={class:"image-uploader-panel"},te={style:{"margin-bottom":"6px","padding-bottom":"6px","border-bottom":"2px solid #5f5f5f","word-break":"break-all"}},le={key:0},se={key:1},oe={style:{"margin-top":"10px"}},re={key:2},ie={style:{"margin-top":"10px"}},ne={style:{"margin-left":"30px","margin-top":"10px"}},ce=A({__name:"leftImg",async setup(e){let a,t;const l=$();l.curModelArrayBuffer=([a,t]=k(()=>async function(e){try{const a=await fetch(e);if(!a.ok)throw new Error(`HTTP error! status: ${a.status}`);return await a.arrayBuffer()}catch(a){return console.error("读取失败:",a),null}}("./plugins/hunyuan3D/model/icegl-bm.glb")),a=await a,t(),a);const s=L(),o=u(null),r=u("https://cdn.index.icegl.cn/uploads/20221122/9ed6756107c4e0c031ae26d54cb46c0d.png"),i=u(!0),n=u(!1),c=D(),m=u("http://localhost:8081/generate");function d({file:e}){o.value=e.file,r.value=URL.createObjectURL(e.file)}async function p(){if(o.value){n.value=!0;try{const a={image:await(e=o.value,new Promise((a,t)=>{const l=new FileReader;l.readAsDataURL(e),l.onload=()=>{const e=l.result.split(",")[1];a(e)},l.onerror=t}))},t=await fetch(m.value,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});l.curModelArrayBuffer=await t.arrayBuffer(),i.value=!0,s.success("传递接口成功，模型已生成")}catch(a){console.error(a),s.error("传递接口失败")}finally{n.value=!1}var e}}function v(){if(!l.curModelArrayBuffer)return void s.error("没有可下载的模型");const e=new Blob([l.curModelArrayBuffer],{type:"model/gltf-binary"}),a=URL.createObjectURL(e);H(a,"generated-model.glb"),URL.revokeObjectURL(a)}function h(){o.value=null,r.value="",i.value=!1,l.curModelArrayBuffer=null}const g=()=>{const e=u(""),a=u(m.value);c.create({title:"请输入混元3D服务地址:",content:()=>C("div",{},[C(E,{value:a.value,placeholder:"服务说明详见'说明'按钮",onInput:t=>{a.value=t,e.value=""}}),e.value&&C(F,{type:"error",style:"margin-top: 8px"},{default:()=>e.value})]),positiveText:"确认",negativeText:"取消",maskClosable:!1,onPositiveClick:()=>a.value.trim()?(m.value=a.value.trim(),!0):(e.value="配置不能为空",!1)})},T=()=>{window.open("https://icegl.cn/ask/article/22765.html","_blank")};return(e,a)=>(f(),w(B,null,[n.value?(f(),w("div",Z,[b("div",ee,[x(y(O),{size:"large"}),a[0]||(a[0]=b("div",{class:"upload-text"},"模型生成中，请稍候...",-1))])])):j("",!0),b("div",ae,[x(y(N),{title:"参考图片生产3D",size:"small",class:"panel-card","header-style":{textAlign:"center"},style:{backgroundColor:"#1a1a1a",color:"#ffffff",border:"1px solid #444"}},{default:_(()=>[b("div",te,[a[3]||(a[3]=b("span",null,"混元3D服务：",-1)),a[4]||(a[4]=b("br",null,null,-1)),b("span",null,S(m.value?m.value:"未配置"),1),x(y(R),{justify:"end"},{default:_(()=>[x(y(U),{type:"primary",size:"tiny",onClick:g},{default:_(()=>[...a[1]||(a[1]=[M(" 设置 ",-1)])]),_:1}),x(y(U),{type:"info",size:"tiny",style:{"margin-right":"6px"},onClick:T},{default:_(()=>[...a[2]||(a[2]=[M(" 说明 ",-1)])]),_:1})]),_:1})]),n.value||i.value?j("",!0):(f(),w("div",le,[x(y(G),{"default-upload":!1,"show-file-list":!1,accept:"image/*",onChange:d},{default:_(()=>[x(y(U),{type:"primary",size:"small"},{default:_(()=>[...a[5]||(a[5]=[M("选择图片",-1)])]),_:1})]),_:1})])),o.value&&!i.value?(f(),w("div",se,[x(y(I),{src:r.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),b("div",oe,[x(y(U),{type:"success",size:"small",loading:n.value,onClick:p},{default:_(()=>[...a[6]||(a[6]=[M(" 提交 ",-1)])]),_:1},8,["loading"])])])):j("",!0),i.value?(f(),w("div",re,[a[9]||(a[9]=b("span",null,"参考图片：",-1)),a[10]||(a[10]=b("br",null,null,-1)),x(y(I),{src:r.value,width:"100",height:"100","object-fit":"cover",style:{"margin-top":"10px"}},null,8,["src"]),x(y(R),null,{default:_(()=>[b("div",ie,[x(y(U),{type:"info",size:"small",onClick:h},{default:_(()=>[...a[7]||(a[7]=[M("重新生产",-1)])]),_:1})]),b("div",ne,[x(y(U),{type:"success",size:"small",onClick:v},{default:_(()=>[...a[8]||(a[8]=[M("下载模型",-1)])]),_:1})])]),_:1})])):j("",!0)]),_:1})])],64))}},[["__scopeId","data-v-2871d219"]]),ue=m({__name:"index",setup(e){const a=T({clearColor:"#201919",shadows:!0,alpha:!1,shadowMapType:s,outputColorSpace:l,toneMapping:t}),c=u(null);return P(()=>{c.value&&(c.value.shadow.mapSize.width=1024,c.value.shadow.mapSize.height=1024,c.value.shadow.camera.near=.1,c.value.shadow.camera.far=10,c.value.shadow.camera.left=-1,c.value.shadow.camera.right=1,c.value.shadow.camera.top=1,c.value.shadow.camera.bottom=-1,c.value.shadow.bias=-1e-4)}),(e,t)=>(f(),w(B,null,[x(y(n),v(a,{"window-size":""}),{default:_(()=>[t[1]||(t[1]=b("TresPerspectiveCamera",{position:[0,1,2],fov:45,near:.1,far:1e3},null,-1)),x(y(o)),t[2]||(t[2]=b("TresAmbientLight",{intensity:2},null,-1)),x(y(r),null,{default:_(()=>[x(W)]),_:1}),x(y(i),{floor:1,segments:20,position:[-.1,-.8,-.5],scale:[4,2,2],"receive-shadow":""},{default:_(()=>[...t[0]||(t[0]=[b("TresMeshPhysicalMaterial",{color:"orange",roughness:1,receiveShadow:""},null,-1)])]),_:1}),b("TresDirectionalLight",{position:[1,1,2],intensity:6,"cast-shadow":"",ref_key:"tdl",ref:c},null,512)]),_:1},16),x(Y),x(y(q),null,{default:_(()=>[x(y(J),null,{default:_(()=>[x(ce)]),_:1})]),_:1})],64))}});export{ue as default};
