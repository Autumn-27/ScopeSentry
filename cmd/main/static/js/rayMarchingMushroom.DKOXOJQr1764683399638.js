import{_ as r,K as n}from"./@tresjs.CJvYCGUA1764683399638.js";import{d as e,a6 as a}from"./three.BbguFgn81764683399638.js";import{d as t,a3 as o,G as c,o as s,I as l,a9 as i,aa as p,q as v,b as f,e as d,f as u,h as m,u as b,m as h}from"./@vue.DjQnunkc1764683399638.js";import"./postprocessing.DjqPXL_K1764683399638.js";import"./@vueuse.BBrxj3Xz1764683399638.js";const y=["rotation"],x={ref:"TresTubeGeometryRef",args:[1e3,1e3]},w=t({__name:"rayMarchingMaterialMushroom",setup(n){const{onBeforeRender:t}=r(),v={transparent:!0,depthWrite:!0,depthTest:!0,side:a,vertexShader:"varying vec2 vUv;\r\nvoid main(){\r\n\tgl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\r\n\tvUv=uv;\r\n}",fragmentShader:"#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\n\r\nuniform vec2 u_resolution;\r\nuniform vec3 u_mouse;\r\nuniform float u_time;\r\nvarying vec2 vUv;\r\n\r\nmat2 rot2D(float angle){\r\n  float s=sin(angle);\r\n  float c=cos(angle);\r\n  return mat2(c,-s,s,c);\r\n}\r\n\r\nfloat sdCutHollowSphere(vec3 p,float r,float h,float t)\r\n{\r\n  float w=sqrt(r*r-h*h);\r\n  vec2 q=vec2(length(p.xz),p.y);\r\n  return((h*q.x<w*q.y)?length(q-vec2(w,h)):\r\n  abs(length(q)-r))-t;\r\n}\r\nvec4 sdstripe(vec3 p,vec3 color){\r\n  p.xz=abs(p.xz);\r\n  float d1=sdCutHollowSphere(p-vec3(.0,-3.3,0.),.8,.01,.01);\r\n  float d2=sdCutHollowSphere(p-vec3(.9,-3.3,.9),.5,.005,.01);\r\n  float d=min(d1,d2);\r\n  return vec4(d,color);\r\n}\r\nvec4 sdCutSphere(vec3 p,float r,float h,vec3 color)\r\n{\r\n  \r\n  float w=sqrt(r*r-h*h);\r\n  \r\n  vec2 q=vec2(length(p.xz),p.y);\r\n  float s=max((h-r)*q.x*q.x+w*w*(h+r-2.*q.y),h*q.x-w*q.y);\r\n  float d=(s<0.)?length(q)-r:\r\n  (q.x<w)?h-q.y:\r\n  length(q-vec2(w,h));\r\n  \r\n  return vec4(d,color);\r\n}\r\nvec4 sdPlane(vec3 p,vec3 color){\r\n  return vec4(-p.y+.2,color);\r\n  \r\n}\r\nvec4 sdCappedCone(vec3 p,vec3 a,vec3 b,float ra,float rb,vec3 color)\r\n{\r\n  float rba=rb-ra;\r\n  float baba=dot(b-a,b-a);\r\n  float papa=dot(p-a,p-a);\r\n  float paba=dot(p-a,b-a)/baba;\r\n  float x=sqrt(papa-paba*paba*baba);\r\n  float cax=max(0.,x-((paba<.5)?ra:rb));\r\n  float cay=abs(paba-.5)-.5;\r\n  float k=rba*rba+baba;\r\n  float f=clamp((rba*(x-ra)+paba*baba)/k,0.,1.);\r\n  float cbx=x-ra-f*rba;\r\n  float cby=paba-f;\r\n  float s=(cbx<0.&&cay<0.)?-1.:1.;\r\n  return vec4(s*sqrt(min(cax*cax+cay*cay*baba,\r\n      cbx*cbx+cby*cby*baba)),color);\r\n    }\r\n    float smin(float d1,float d2,float k){\r\n      float h=clamp(.5+.5*(d2-d1)/k,0.,1.);\r\n      return mix(d2,d1,h)-k*h*(1.-h);\r\n    }\r\n    vec4 colorMin(vec4 a,vec4 b){\r\n      if(a.x<b.x){\r\n        return a;\r\n      }else{\r\n        return b;\r\n      }\r\n    }\r\n    //模糊摆动，y的值越大，摆动频率越大\r\n    vec3 bendPoint(vec3 p,float k)\r\n    {\r\n      float c=cos(k*p.y);\r\n      float s=sin(k*p.y);\r\n      mat2 m=mat2(c,-s,s,c);\r\n      vec3 q=vec3(m*p.xy,p.z);\r\n      return q;\r\n    }\r\n    vec4 map(vec3 p){\r\n      vec3 q=p;\r\n      p=bendPoint(p,sin(u_time*5.));\r\n      vec3 pp2=vec3(0.,.8,0.);\r\n      vec3 pp1=vec3(0.,-.2,0.);\r\n      vec4 CappedConesdf=sdCappedCone(-p,pp1,pp2,.2,.1,vec3(.8667,.8667,.7216));\r\n      vec4 CutSpheresdf=sdCutSphere(-p-vec3(0.,.4,0.),.5,.2,vec3(.9608,.4667,.4))-.1;\r\n      vec4 entity=colorMin(CappedConesdf,CutSpheresdf);\r\n      entity=colorMin(entity,sdstripe(p*4.,vec3(3.5))/4.);\r\n      entity=colorMin(entity,sdPlane(q,vec3(.4196,.5529,.3647)));\r\n      return entity;\r\n    }\r\n    \r\n    void main(){\r\n      vec3 ro=vec3(0.,0.,-8.);//起始位置\r\n      vec3 rd=normalize(vec3(vUv-.5,1.));//方向\r\n      ro.xz*=rot2D(-u_time);\r\n      rd.xz*=rot2D(-u_time);\r\n      ro.y-=4.;\r\n      rd.y+=.5;\r\n      float t=0.;\r\n      vec4 color=vec4(0.);\r\n      for(int i=0;i<80;i++){\r\n        vec3 p=ro+rd*t;\r\n        vec4 d=map(p)/1.8;\r\n        t+=d.x;\r\n        //优化效率\r\n        if(t>100.||d.x<.001){\r\n          break;\r\n        }\r\n        color=vec4(t*d.yzw*.13,1.);\r\n      }\r\n      \r\n      gl_FragColor=color;\r\n      \r\n    }",uniforms:{u_resolution:{value:new e(window.innerWidth,window.innerHeight)},u_mouse:{value:new e(0,0)},u_time:{value:0}}},f=window.innerWidth/2,d=window.innerHeight/2;let u=0,m=0;return document.addEventListener("mousemove",function(r){u=r.clientX-f,m=r.clientY-d},!1),o(()=>{}),t(({elapsed:r})=>{v.uniforms.u_time.value+=.001,v.uniforms.u_mouse.value=new e(u,m)}),(r,n)=>(s(),c("TresMesh",{ref:"MeshRef",rotation:[Math.PI/2,0,0]},[l("TresPlaneGeometry",x,null,512),l("TresShaderMaterial",i(p(v)),null,16)],8,y))}}),g={ref:"perspectiveCameraRef",position:[0,1500,0],fov:45,near:1,far:1e4},q=t({__name:"rayMarchingMushroom",setup(r){const e={clearColor:"#000000",shadows:!0,alpha:!1,useLegacyLights:!0},a={autoRotate:!1,enableDamping:!0};return v(()=>{}),(r,t)=>{const o=f("TresCanvas");return s(),d(o,h(e,{"window-size":""}),{default:u(()=>[l("TresPerspectiveCamera",g,null,512),m(b(n),i(p(a)),null,16),t[0]||(t[0]=l("TresAmbientLight",{color:"#ffffff"},null,-1)),t[1]||(t[1]=l("TresDirectionalLight",{position:[100,100,0],intensity:.5,color:"#ffffff"},null,-1)),m(w)]),_:1},16)}}});export{q as default};
