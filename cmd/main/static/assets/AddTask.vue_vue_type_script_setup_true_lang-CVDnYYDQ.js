import{d as e,s as a,r as l,H as t,a5 as o,o as d,c as s,e as u,w as r,a as n,A as c,i as p,j as i,z as m,t as y,B as g,af as f,F as h,Q as k,l as b,M as v,f as _}from"./index-DZkrNvQC.js";import{E as V}from"./el-checkbox-DD3shB1l.js";import{E as w}from"./el-divider-CIgyF90M.js";import{a as j,E as T}from"./el-form-BfI3XjdN.js";import{E as x,a as N}from"./el-col-s8XiVykl.js";import{E as S}from"./el-switch-DQ-8-AeJ.js";import"./el-tooltip-l0sNRNKZ.js";import{E}from"./el-popper-VZvChD93.js";import{E as U,b as P}from"./el-radio-group-S2IhOR0A.js";import"./el-tag-BLiRkvOU.js";import"./el-virtual-list-C5e1EhKc.js";import{E as M}from"./el-select-v2-BGPoFHQG.js";import{E as D,b as F}from"./el-select-Cg9roJ9C.js";/* empty css                */import{E as A}from"./el-tree-select-DiDASL90.js";import{a as I}from"./index-DcAyUTv-.js";import{i as C,j as q,k as z,h as B,l as R,m as L}from"./index-BmUPBzHH.js";import{_ as $}from"./Dialog.vue_vue_type_style_index_0_lang-CN4G-oAc.js";import Q from"./DetailTemplate-Dm7Tpk1q.js";import{g as G}from"./index-BBLEyzLO.js";const H={style:{float:"left"}},K=e({__name:"AddTask",props:{closeDialog:{type:Function},getList:{type:Function},create:{type:Boolean},schedule:{type:Boolean},taskid:{},tp:{},targetIds:{},getFilter:{type:Function},searchParams:{}},setup(e){const{t:K}=b(),O=e,J=!!O.tp.includes("Source"),W=a({name:[{required:!0,message:K("task.msgTaskName"),trigger:"blur"}],target:[{required:!J,message:K("task.msgTarget"),trigger:"blur"}],node:[{required:!0,message:K("task.nodeMsg"),trigger:"blur"}],template:[{required:!0,message:"Please select template",trigger:"blur"}],day:[{message:"1-31",trigger:"change",validator:(e,a,l)=>{a&&/^\d+$/.test(a)?a<1||a>31?l(new Error("1-31")):l():l(new Error("1-31"))}}],hour:[{message:"0-24",trigger:"change",validator:(e,a,l)=>{a&&/^\d+$/.test(a)?a<0||a>24?l(new Error("0-24")):l():l(new Error("0-24"))}}],minute:[{message:"0-60",trigger:"change",validator:(e,a,l)=>{a&&/^\d+$/.test(a)?a<0||a>60?l(new Error("0-60")):l():l(new Error("0-60"))}}]}),X=l(!1),Y=l(),Z=a([]),ee=a([]),ae=async()=>{ee.length=0;const e=await B("",1,1e3);e.data.list.length>0&&e.data.list.forEach((e=>{ee.push({value:e.id,label:e.name})}))};t((()=>{(async()=>{const e=await I();e.data.list.length>0?(te.value=!1,e.data.list.forEach((e=>{Z.push({value:e,label:e})}))):(te.value=!0,v.warning(K("node.onlineNodeMsg")))})(),ae()}));const le=l(!1),te=l(!1),oe=a({name:"",target:"",ignore:"",node:[],allNode:!0,scheduledTasks:!1,duplicates:"None",template:"",cycleType:"daily",search:"",project:[],targetSource:"general",day:1,hour:1,minute:30,week:1,bindProject:null}),de=e=>{le.value=!1,e?(oe.node=[],Z.forEach((e=>oe.node.push(e.value)))):oe.node=[]},se=l(""),ue=l(!1);let re=K("task.addTemplate");const ne=async e=>{se.value=e,""!=e&&(re=K("task.editTemplate")),ue.value=!0},ce=()=>{ue.value=!1};o((()=>O.taskid),(async e=>{e?O.schedule?await(async e=>{const a=await L(e);oe.name=a.data.name,oe.target=a.data.target,oe.ignore=a.data.ignore,oe.node=a.data.node,oe.allNode=a.data.allNode,oe.scheduledTasks=a.data.scheduledTasks,oe.hour=a.data.hour,oe.duplicates=a.data.duplicates,oe.template=a.data.template,oe.project=a.data.project,oe.targetSource=a.data.targetSource,oe.day=a.data.day,oe.minute=a.data.minute,oe.week=a.data.week,oe.cycleType=a.data.cycleType})(e):await(async e=>{const a=await R(e);oe.name=a.data.name,oe.target=a.data.target,oe.ignore=a.data.ignore,oe.node=a.data.node,oe.allNode=a.data.allNode,oe.scheduledTasks=a.data.scheduledTasks,oe.hour=a.data.hour,oe.duplicates=a.data.duplicates,oe.template=a.data.template,oe.day=a.data.day,oe.minute=a.data.minute,oe.week=a.data.week,oe.cycleType=a.data.cycleType})(e):(O.schedule?oe.scheduledTasks=!0:oe.scheduledTasks=!1,oe.name="",oe.target="",oe.ignore="",oe.node=[],oe.allNode=!0,oe.duplicates="None",oe.template="")}),{immediate:!0});const pe=l("select"),ie=l(0),me=[{label:K("task.general"),value:"general"},{label:K("task.fromProject"),value:"project"},{label:K("task.fromAsset"),value:"asset"},{label:K("task.fromRootDomain"),value:"RootDomain"},{label:K("task.fromSubdomain"),value:"subdomain"}],ye=a([]);return(async()=>{(await G()).data.list.forEach((e=>{ye.push(e)}))})(),(e,l)=>(d(),s(h,null,[u(n(T),{model:oe,"label-width":"auto",rules:W,"status-icon":"",ref_key:"ruleFormRef",ref:Y,disabled:!e.create},{default:r((()=>[u(n(j),{label:n(K)("task.taskName"),prop:"name"},{default:r((()=>[u(n(c),{modelValue:oe.name,"onUpdate:modelValue":l[0]||(l[0]=e=>oe.name=e),placeholder:n(K)("task.msgTaskName")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),n(J)?i("",!0):(d(),p(n(j),{key:0,label:n(K)("task.targetSource")},{default:r((()=>[u(n(M),{style:{width:"50%"},modelValue:oe.targetSource,"onUpdate:modelValue":l[1]||(l[1]=e=>oe.targetSource=e),options:me},null,8,["modelValue"])])),_:1},8,["label"])),"project"==oe.targetSource||"general"==oe.targetSource||n(J)?i("",!0):(d(),p(n(N),{key:1},{default:r((()=>[u(n(x),{span:12},{default:r((()=>[u(n(j),{label:n(K)("task.search")},{default:r((()=>[n(J)?i("",!0):(d(),p(n(c),{key:0,modelValue:oe.search,"onUpdate:modelValue":l[2]||(l[2]=e=>oe.search=e),placeholder:n(K)("form.input")},null,8,["modelValue","placeholder"]))])),_:1},8,["label"])])),_:1}),u(n(x),{span:12},{default:r((()=>[u(n(j),{label:n(K)("task.targetProject")},{default:r((()=>[u(n(A),{modelValue:oe.project,"onUpdate:modelValue":l[3]||(l[3]=e=>oe.project=e),data:ye,placeholder:n(K)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["modelValue","data","placeholder"])])),_:1},8,["label"])])),_:1})])),_:1})),"project"==oe.targetSource?(d(),p(n(j),{key:2,label:n(K)("task.targetProject")},{default:r((()=>[u(n(A),{modelValue:oe.project,"onUpdate:modelValue":l[4]||(l[4]=e=>oe.project=e),data:ye,placeholder:n(K)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["modelValue","data","placeholder"])])),_:1},8,["label"])):i("",!0),"general"==oe.targetSource?(d(),p(n(j),{key:3,label:n(K)("task.taskTarget"),prop:"target"},{default:r((()=>[n(J)?i("",!0):(d(),p(n(c),{key:0,modelValue:oe.target,"onUpdate:modelValue":l[5]||(l[5]=e=>oe.target=e),placeholder:n(K)("task.msgTarget"),type:"textarea",rows:"10"},null,8,["modelValue","placeholder"])),n(J)?(d(),p(n(U),{key:1,modelValue:pe.value,"onUpdate:modelValue":l[6]||(l[6]=e=>pe.value=e)},{default:r((()=>[u(n(P),{value:"select"},{default:r((()=>[m(y(n(K)("task.select")),1)])),_:1}),u(n(P),{value:"search"},{default:r((()=>[m(y(n(K)("export.exportTypeSearch")),1)])),_:1})])),_:1},8,["modelValue"])):i("",!0)])),_:1},8,["label"])):i("",!0),"search"==pe.value&&n(J)?(d(),p(n(j),{key:4,label:n(K)("task.targetNumber")},{default:r((()=>[u(n(c),{modelValue:ie.value,"onUpdate:modelValue":l[7]||(l[7]=e=>ie.value=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1},8,["label"])):i("",!0),"project"!=oe.targetSource?(d(),p(n(j),{key:5,label:n(K)("task.ignore"),prop:"ignore"},{default:r((()=>[u(n(c),{modelValue:oe.ignore,"onUpdate:modelValue":l[8]||(l[8]=e=>oe.ignore=e),placeholder:n(K)("task.ignoreMsg"),type:"textarea",rows:"5"},null,8,["modelValue","placeholder"])])),_:1},8,["label"])):i("",!0),u(n(N),null,{default:r((()=>[u(n(x),{span:12},{default:r((()=>[u(n(j),{label:n(K)("task.nodeSelect"),prop:"node"},{default:r((()=>[u(n(M),{modelValue:oe.node,"onUpdate:modelValue":l[9]||(l[9]=e=>oe.node=e),filterable:"",options:Z,placeholder:"Please select node",style:{width:"80%"},multiple:"","tag-type":"success","collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":7},{header:r((()=>[u(n(V),{disabled:te.value,indeterminate:le.value,onChange:de},{default:r((()=>[m(" All ")])),_:1},8,["disabled","indeterminate"])])),_:1},8,["modelValue","options"])])),_:1},8,["label"])])),_:1}),u(n(x),{span:12},{default:r((()=>[u(n(j),{label:n(K)("task.autoNode")},{default:r((()=>[u(n(E),{effect:"dark",content:n(K)("task.selectNodeMsg"),placement:"top"},{default:r((()=>[u(n(S),{modelValue:oe.allNode,"onUpdate:modelValue":l[10]||(l[10]=e=>oe.allNode=e),"inline-prompt":"","active-text":n(K)("common.switchAction"),"inactive-text":n(K)("common.switchInactive")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["content"])])),_:1},8,["label"])])),_:1})])),_:1}),u(n(j),{label:n(K)("project.scheduledTasks")},{default:r((()=>[u(n(E),{effect:"dark",content:n(K)("project.msgScheduledTasks"),placement:"top"},{default:r((()=>[u(n(S),{modelValue:oe.scheduledTasks,"onUpdate:modelValue":l[11]||(l[11]=e=>oe.scheduledTasks=e),"inline-prompt":"","active-text":n(K)("common.switchAction"),"inactive-text":n(K)("common.switchInactive")},null,8,["modelValue","active-text","inactive-text"])])),_:1},8,["content"])])),_:1},8,["label"]),oe.scheduledTasks?(d(),p(n(j),{key:6,label:n(K)("project.cycle"),prop:"type"},{default:r((()=>[u(n(N),{gutter:10,style:{width:"100%"}},{default:r((()=>[u(n(x),{span:5},{default:r((()=>[u(n(D),{modelValue:oe.cycleType,"onUpdate:modelValue":l[12]||(l[12]=e=>oe.cycleType=e),style:{width:"100%"}},{default:r((()=>[u(n(F),{label:n(K)("task.daily"),value:"daily"},null,8,["label"]),u(n(F),{label:n(K)("task.ndays"),value:"ndays"},null,8,["label"]),u(n(F),{label:n(K)("task.nhours"),value:"nhours"},null,8,["label"]),u(n(F),{label:n(K)("task.weekly"),value:"weekly"},null,8,["label"]),u(n(F),{label:n(K)("task.monthly"),value:"monthly"},null,8,["label"])])),_:1},8,["modelValue"])])),_:1}),"weekly"==oe.cycleType?(d(),p(n(x),{key:0,span:5},{default:r((()=>[u(n(D),{modelValue:oe.week,"onUpdate:modelValue":l[13]||(l[13]=e=>oe.week=e),modelModifiers:{number:!0},style:{width:"100%"}},{default:r((()=>[u(n(F),{label:n(K)("task.monday"),value:0},null,8,["label"]),u(n(F),{label:n(K)("task.tuesday"),value:1},null,8,["label"]),u(n(F),{label:n(K)("task.wednesday"),value:2},null,8,["label"]),u(n(F),{label:n(K)("task.thursday"),value:3},null,8,["label"]),u(n(F),{label:n(K)("task.friday"),value:4},null,8,["label"]),u(n(F),{label:n(K)("task.saturday"),value:5},null,8,["label"]),u(n(F),{label:n(K)("task.sunday"),value:6},null,8,["label"])])),_:1},8,["modelValue"])])),_:1})):i("",!0),"ndays"===oe.cycleType||"monthly"==oe.cycleType?(d(),p(n(x),{key:1,span:5},{default:r((()=>[u(n(j),{prop:"day"},{default:r((()=>[u(n(c),{style:{width:"100%"},modelValue:oe.day,"onUpdate:modelValue":l[14]||(l[14]=e=>oe.day=e),modelModifiers:{number:!0}},{append:r((()=>[m(y(n(K)("task.day")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1})):i("",!0),"daily"===oe.cycleType||"ndays"===oe.cycleType||"nhours"==oe.cycleType||"weekly"==oe.cycleType||"monthly"==oe.cycleType?(d(),p(n(x),{key:2,span:5},{default:r((()=>[u(n(j),{prop:"hour"},{default:r((()=>[u(n(c),{style:{width:"100%"},modelValue:oe.hour,"onUpdate:modelValue":l[15]||(l[15]=e=>oe.hour=e),modelModifiers:{number:!0}},{append:r((()=>[m(y(n(K)("task.hour")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1})):i("",!0),"daily"===oe.cycleType||"ndays"===oe.cycleType||"nhours"==oe.cycleType||"weekly"==oe.cycleType||"monthly"==oe.cycleType?(d(),p(n(x),{key:3,span:5},{default:r((()=>[u(n(j),{prop:"minute"},{default:r((()=>[u(n(c),{style:{width:"100%"},modelValue:oe.minute,"onUpdate:modelValue":l[16]||(l[16]=e=>oe.minute=e),modelModifiers:{number:!0}},{append:r((()=>[m(y(n(K)("task.minute")),1)])),_:1},8,["modelValue"])])),_:1})])),_:1})):i("",!0)])),_:1})])),_:1},8,["label"])):i("",!0),u(n(w),{"content-position":"center",style:{width:"60%",left:"20%"}},{default:r((()=>[m(y(n(K)("task.duplicates")),1)])),_:1}),u(n(N),null,{default:r((()=>[u(n(x),{span:24},{default:r((()=>[u(n(j),{label:n(K)("task.duplicates"),prop:"type"},{default:r((()=>[u(n(U),{modelValue:oe.duplicates,"onUpdate:modelValue":l[17]||(l[17]=e=>oe.duplicates=e)},{default:r((()=>[u(n(P),{label:"None",name:"duplicates",checked:!0,value:"None"}),u(n(E),{effect:"dark",content:n(K)("task.duplicatesMsg"),placement:"top"},{default:r((()=>[u(n(P),{label:n(K)("task.duplicatesSubdomain"),name:"duplicates",value:"subdomain"},null,8,["label"])])),_:1},8,["content"])])),_:1},8,["modelValue"])])),_:1},8,["label"])])),_:1})])),_:1}),u(n(w),{"content-position":"center",style:{width:"60%",left:"20%"}},{default:r((()=>[m(y(n(K)("router.scanTemplate")),1)])),_:1}),u(n(j),{label:n(K)("router.scanTemplate"),prop:"template"},{default:r((()=>[u(n(D),{modelValue:oe.template,"onUpdate:modelValue":l[19]||(l[19]=e=>oe.template=e),placeholder:"Please select template",style:{width:"30%"}},{footer:r((()=>[u(n(g),{type:"success",size:"small",plain:"",style:{"margin-left":"15px"},onClick:l[18]||(l[18]=f((e=>ne("")),["stop"]))},{default:r((()=>[m(y(n(K)("common.new")),1)])),_:1})])),default:r((()=>[(d(!0),s(h,null,k(ee,(e=>(d(),p(n(F),{key:e.value,label:e.label,value:e.value},{default:r((()=>[u(n(N),null,{default:r((()=>[u(n(x),{span:16},{default:r((()=>[_("span",H,y(e.label),1)])),_:2},1024),u(n(x),{span:8},{default:r((()=>[u(n(g),{type:"primary",size:"small",style:{"margin-left":"15px"},onClick:f((a=>ne(e.value)),["stop"])},{default:r((()=>[m(y(n(K)("common.edit")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["label"]),u(n(w)),u(n(N),null,{default:r((()=>[u(n(x),{span:2,offset:10},{default:r((()=>[u(n(j),null,{default:r((()=>[u(n(g),{type:"primary",onClick:l[20]||(l[20]=e=>(async e=>{X.value=!0;try{if(!e)return;if(await e.validate()){let e,l=a({});"search"==pe.value&&(O.getFilter&&(l=O.getFilter()),O.searchParams&&(oe.search=O.searchParams)),J&&(oe.targetSource=O.tp),e=O.taskid?await C(O.taskid,oe.name,oe.target,oe.ignore,oe.node,oe.allNode,oe.duplicates,oe.scheduledTasks,oe.hour,oe.template,pe.value,oe.search,l,ie.value,O.targetIds,oe.project,oe.targetSource,oe.day,oe.minute,oe.week,oe.bindProject,oe.cycleType):O.schedule?await q(oe.name,oe.target,oe.ignore,oe.node,oe.allNode,oe.duplicates,oe.scheduledTasks,oe.hour,oe.template,pe.value,oe.search,l,ie.value,O.targetIds,oe.project,oe.targetSource,oe.day,oe.minute,oe.week,oe.bindProject,oe.cycleType):await z(oe.name,oe.target,oe.ignore,oe.node,oe.allNode,oe.duplicates,oe.scheduledTasks,oe.hour,oe.template,pe.value,oe.search,l,ie.value,O.targetIds,oe.project,oe.targetSource,oe.day,oe.minute,oe.week,oe.bindProject,oe.cycleType),200===e.code&&(O.closeDialog(),O.getList())}}catch(l){}finally{X.value=!1}})(Y.value)),loading:X.value},{default:r((()=>[m(y(n(K)("task.save")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","disabled"]),u(n($),{modelValue:ue.value,"onUpdate:modelValue":l[21]||(l[21]=e=>ue.value=e),title:n(re),center:"",fullscreen:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:r((()=>[u(Q,{closeDialog:ce,getList:ae,id:se.value},null,8,["id"])])),_:1},8,["modelValue","title"])],64))}});export{K as _};
