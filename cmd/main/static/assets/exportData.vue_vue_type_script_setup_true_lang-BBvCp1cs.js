import{d as e,s as a,e as t,G as l,F as o,r as i,H as r,o as s,i as n,w as d,a as u,z as p,t as c,A as m,c as f,Q as y,B as v,J as x,l as b}from"./index-DWh4xxRh.js";import{E as _,a as g}from"./el-tab-pane-B_EZvkyX.js";import{E as w,a as h}from"./el-form-BEnwIHoU.js";import{E as j,b as V}from"./el-radio-group-C3fyAYh1.js";import{E}from"./el-tag-Dqn7ck2B.js";import{E as R}from"./el-space-DsIC9jqE.js";import{E as U,a as S}from"./el-checkbox-CnlMCstA.js";/* empty css                          */import{r as T}from"./index-B7SYradf.js";import{_ as k}from"./Table.vue_vue_type_script_lang-BODj4qRW.js";import{u as C}from"./useTable-QbVuDe8y.js";const A=e=>T.post({url:"/api/export/delete",data:{ids:e}});function F(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!x(e)}const L=e({__name:"exportData",props:{index:{},searchParams:{},getFilter:{type:Function}},setup(e){const{t:x}=b(),L=e,q=a({type:"all",quantity:0}),B=async()=>{G.value=!0;const e=L.getFilter();await((e,a,t,l,o,i,r)=>T.post({url:"/api/export",data:{index:e,quantity:a,type:t,search:l,filter:o,field:i,filetype:r}}))(L.index,q.quantity,q.type,L.searchParams,e,oe.value,se.value),G.value=!1},D=a([{field:"selection",type:"selection"},{field:"action",label:x("tableDemo.action"),fixed:"left",formatter:(e,a,i)=>{let r,s;return t(o,null,[t(l,{type:"success",onClick:()=>Q(e.file_name)},F(r=x("export.download"))?r:{default:()=>[r]}),t(l,{type:"danger",onClick:()=>K(e)},F(s=x("common.delete"))?s:{default:()=>[s]})])}},{field:"file_name",label:x("export.fileName")},{field:"state",label:x("export.state"),formatter:(e,a,l)=>{if(0==l){let e;return t(E,{type:"info"},F(e=x("export.run"))?e:{default:()=>[e]})}if(1==l){let e;return t(E,{type:"success"},F(e=x("export.success"))?e:{default:()=>[e]})}{let e;return t(E,{type:"danger"},F(e=x("export.fail"))?e:{default:()=>[e]})}}},{field:"create_time",label:x("export.createTime")},{field:"end_time",label:x("export.endTime"),formatter:(e,a,t)=>""==t?"-":t},{field:"data_type",label:x("export.type")},{field:"file_size",label:x("export.fileSize"),formatter:(e,a,t)=>""==t?"-":t+" MB"}]),{tableRegister:M,tableState:N,tableMethods:O}=C({fetchDataApi:async()=>({list:(await T.get({url:"/api/export/records"})).data.list}),immediate:!1}),{dataList:P,loading:z}=N,{getList:I,getElTableExpose:H}=O,Q=async e=>{try{const a=await(e=>new Promise(((a,t)=>{T.get({url:"/api/export/download?filename="+e,responseType:"blob"}).then((e=>{a(e.data)})).catch((e=>{t(e)}))})))(e),t=window.URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`${e}`,l.click(),window.URL.revokeObjectURL(t)}catch(a){}},G=i(!1),J=e=>{"exportRecords"==e&&I()},$=i(!1),K=async e=>{window.confirm("Are you sure you want to delete the selected data?")&&await W(e)},W=async e=>{$.value=!0;try{await A([e.file_name]);$.value=!1,I()}catch(a){$.value=!1,I()}},X=async()=>{window.confirm("Are you sure you want to delete the selected data?")&&await Z()},Y=i([]),Z=async()=>{const e=await H(),a=(null==e?void 0:e.getSelectionRows())||[];Y.value=a.map((e=>e.file_name)),$.value=!0;try{await A(Y.value);$.value=!1,I()}catch(t){$.value=!1,I()}},ee=i([]),ae=async()=>{const e=await(a=L.index,T.post({url:"/api/export/fields",data:{index:a}}));var a;ee.value=e.data.field};r((()=>{ae()}));const te=i(!0),le=i(!1),oe=i([]),ie=e=>{oe.value=e?ee.value:[],te.value=!1},re=e=>{const a=e.length;le.value=a===ee.value.length,te.value=a>0&&a<ee.value.length},se=i("csv");return(e,a)=>(s(),n(u(g),{tabPosition:"left",onTabChange:J,"model-value":"export"},{default:d((()=>[t(u(_),{label:u(x)("asset.export"),name:"export"},{default:d((()=>[t(u(w),{model:q,"label-width":"auto",style:{position:"relative"}},{default:d((()=>[t(u(h),{label:u(x)("export.exportType")},{default:d((()=>[t(u(j),{modelValue:q.type,"onUpdate:modelValue":a[0]||(a[0]=e=>q.type=e)},{default:d((()=>[t(u(V),{value:"all"},{default:d((()=>[p(c(u(x)("export.exportTypeAll")),1)])),_:1}),t(u(V),{value:"search"},{default:d((()=>[p(c(u(x)("export.exportTypeSearch")),1)])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),t(u(h),{label:u(x)("export.exportQuantity")},{default:d((()=>[t(u(m),{modelValue:q.quantity,"onUpdate:modelValue":a[1]||(a[1]=e=>q.quantity=e),modelModifiers:{number:!0}},null,8,["modelValue"])])),_:1},8,["label"]),t(u(h),{label:u(x)("export.field")},{default:d((()=>[t(u(U),{modelValue:le.value,"onUpdate:modelValue":a[2]||(a[2]=e=>le.value=e),indeterminate:te.value,onChange:ie},{default:d((()=>[p(" All ")])),_:1},8,["modelValue","indeterminate"])])),_:1},8,["label"]),t(u(h),{label:" "},{default:d((()=>[t(u(S),{modelValue:oe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>oe.value=e),onChange:re},{default:d((()=>[(s(!0),f(o,null,y(ee.value,(e=>(s(),n(u(U),{key:e,label:e,value:e},{default:d((()=>[p(c(e),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),t(u(h),{label:u(x)("export.fileType")},{default:d((()=>[t(u(j),{modelValue:se.value,"onUpdate:modelValue":a[4]||(a[4]=e=>se.value=e)},{default:d((()=>[t(u(V),{value:"xlsx"},{default:d((()=>[p("csv")])),_:1}),t(u(V),{value:"json"},{default:d((()=>[p("json")])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["label"]),t(u(h),null,{default:d((()=>[t(u(v),{type:"primary",onClick:B,style:{left:"40%",position:"relative"},loading:G.value},{default:d((()=>[p(" Create ")])),_:1},8,["loading"])])),_:1})])),_:1},8,["model"])])),_:1},8,["label"]),t(u(_),{label:u(x)("export.exportRecords"),name:"exportRecords"},{default:d((()=>[t(u(R),{direction:"vertical",alignment:"flex-start",style:{width:"100%"}},{default:d((()=>[t(u(l),{type:"danger",loading:$.value,onClick:X},{default:d((()=>[p(c(u(x)("common.delete")),1)])),_:1},8,["loading"])])),_:1}),t(u(k),{onRegister:u(M),columns:D,data:u(P),loading:u(z),"max-height":"500",style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji",width:"100%"}},null,8,["onRegister","columns","data","loading"])])),_:1},8,["label"])])),_:1}))}});export{L as _};
