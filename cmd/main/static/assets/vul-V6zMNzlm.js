import{d as e,r as t,s as l,e as a,L as i,v as o,A as s,B as r,G as n,z as u,F as p,H as c,y as d,o as m,c as v,a as g,w as h,I as f,t as b,f as x,J as y,l as j,X as _,_ as w}from"./index-DWh4xxRh.js";import{u as S}from"./useTable-QbVuDe8y.js";import{E as k}from"./el-card-DrByBI6h.js";import{E as C}from"./el-pagination-B2845WD-.js";import{E as V}from"./el-tag-Dqn7ck2B.js";import{b as E,E as L}from"./el-select-DR5j0e2B.js";import"./el-popper-GV40Ylvp.js";import{E as R,a as H}from"./el-col-CsJdbd3u.js";import{E as z,a as T}from"./el-descriptions-item-CUtQ2YZJ.js";import{E as U}from"./el-text-B_U4CRJ-.js";import{_ as A}from"./Dialog.vue_vue_type_style_index_0_lang-BLrEJZod.js";import{_ as I}from"./Table.vue_vue_type_script_lang-BODj4qRW.js";import{u as D}from"./useCrudSchemas-CJ88Chq9.js";import{r as F}from"./index-B7SYradf.js";import O from"./Csearch-BTJ52FMx.js";import{u as W,a as P,d as q}from"./index-CxCJ-xoP.js";import{_ as M}from"./Detail.vue_vue_type_script_setup_true_lang-C5_0p378.js";import{g as $}from"./index-DJP63K0O.js";import"./index-CoLImKnr.js";import"./strings-BoCwLL8D.js";import"./useInput-BUoj5p43.js";import"./debounce-DObHaw-f.js";import"./refs-DzdS_lik.js";import"./el-table-column-CQJcvWeY.js";import"./el-checkbox-CnlMCstA.js";import"./isArrayLikeObject-D2SOc5NV.js";import"./raf-DRYha3yg.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-image-viewer-DkYfH_ll.js";import"./el-empty-CIDlEJkA.js";import"./tsxHelper-CrqfgGtK.js";import"./el-dropdown-item-_1wOFGYn.js";import"./castArray-CDoyBY0w.js";import"./index-XjQbcd_8.js";import"./tree-BfZhwLPs.js";import"./ContentWrap.vue_vue_type_script_setup_true_lang-BN-W48yH.js";import"./el-divider-b7GgpLQ5.js";import"./el-autocomplete-BqvQdsF3.js";/* empty css                */import"./el-tree-select-BvfHJSN0.js";import"./index-BcFA4KpU.js";import"./el-switch-Bhy7j-ed.js";import"./useIcon-DFA9sTIs.js";import"./exportData.vue_vue_type_script_setup_true_lang-BBvCp1cs.js";import"./el-tab-pane-B_EZvkyX.js";import"./el-form-BEnwIHoU.js";import"./el-radio-group-C3fyAYh1.js";import"./el-space-DsIC9jqE.js";/* empty css                          */import"./AddTask.vue_vue_type_script_setup_true_lang-0SsIleKm.js";import"./el-virtual-list-D4VQU3Kd.js";import"./el-select-v2-B_IkYGMu.js";import"./index-BX1T3cyM.js";import"./index-CgNRM65z.js";import"./DetailTemplate-C1iLBEAR.js";import"./index-DM9CpuTH.js";import"./index-BJkpQCV9.js";import"./index-2xqEbz84.js";const N={style:{whiteSpace:"pre-line",width:"500px"}},K={style:{whiteSpace:"pre-line"}};function B(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!y(e)}const J=w(e({__name:"vul",props:{projectList:{}},setup(e){const{t:y}=j(),w=[{keyword:"url",example:'url="http://example.com"',explain:y("searchHelp.url")},{keyword:"vulname",example:'vulname="nginxwebui-runcmd-rce"',explain:y("searchHelp.vulname")},{keyword:"level",example:'level="info"',explain:y("searchHelp.level")},{keyword:"matched",example:'matched="https://example.com"',explain:y("searchHelp.matched")},{keyword:"request",example:'request="cmd=whoami"',explain:y("searchHelp.vulRequest")},{keyword:"response",example:'response="root"',explain:y("searchHelp.response")},{keyword:"project",example:'project="Hackerone"',explain:y("searchHelp.project")}],J=t(""),G=e=>{J.value=e,pe()},Q=l({}),X=l([{field:"selection",type:"selection",minWidth:"55"},{field:"index",label:y("tableDemo.index"),type:"index",minWidth:55},{field:"url",label:"URL",minWidth:100},{field:"vulnerability",label:"Vulnerability",minWidth:120},{field:"level",label:"Level",minWidth:100,columnKey:"level",formatter:(e,t,l)=>{if(null==l)return a("div",null,null);let o="",s="";return"critical"===l?(o="red",s=y("poc.critical")):"high"===l?(o="orange",s=y("poc.high")):"medium"===l?(o="yellow",s=y("poc.medium")):"low"===l?(o="blue",s=y("poc.low")):"info"===l?(o="green",s=y("poc.info")):"unknown"===l&&(o="gray",s=y("poc.unknown")),a(H,{gutter:20,style:"width: 80%"},{default:()=>[a(R,{span:1},{default:()=>[a(i,{icon:"clarity:circle-solid",color:o},null)]}),a(R,{span:5},{default:()=>[a(U,{type:"info"},B(s)?s:{default:()=>[s]})]})]})},filters:[{text:y("poc.critical"),value:"critical"},{text:y("poc.high"),value:"high"},{text:y("poc.medium"),value:"medium"},{text:y("poc.low"),value:"low"},{text:y("poc.info"),value:"info"},{text:y("poc.unknown"),value:"unknown"}]},{field:"matched",label:"Matched",minWidth:150},{field:"status",label:y("common.state"),minWidth:100,columnKey:"status",formatter:(e,t,l)=>{let i;null==e.status&&(e.status=1),0==e.status&&(e.status=1);const o=[{value:1,label:y("common.unprocessed"),color:"#909399"},{value:2,label:y("common.processing"),color:"#409EFF"},{value:3,label:y("common.ignored"),color:"#C0C4CC"},{value:4,label:y("common.suspected"),color:"#E6A23C"},{value:5,label:y("common.confirmed"),color:"#F56C6C"},{value:6,label:y("common.processed"),color:"#67C23A"}],s=o.find((t=>t.value===e.status)),r=(null==s?void 0:s.color)||"#000";return a(L,{modelValue:e.status,class:"colored-select","popper-class":"colored-select-popper",style:{"--select-text-color":r},"onUpdate:modelValue":async t=>{try{e.status=t,await W(e.id,Y,t)}catch(l){}}},B(i=o.map((e=>a(E,{key:e.value,label:e.label,value:e.value,style:{color:e.color}},null))))?i:{default:()=>[i]})},filters:[{text:y("common.unprocessed"),value:1},{text:y("common.processing"),value:2},{text:y("common.ignored"),value:3},{text:y("common.suspected"),value:4},{text:y("common.confirmed"),value:5}]},{field:"tags",label:"TAG",fit:"true",showOverflowTooltip:!1,formatter:(e,l,a)=>{null==a&&(a=[]),Q[e.id]||(Q[e.id]={inputVisible:!1,inputValue:"",inputRef:t(null)});const i=Q[e.id],n=async()=>{i.inputValue&&(a.push(i.inputValue),P(e.id,Y,i.inputValue)),i.inputVisible=!1,i.inputValue=""};return o(H,{},(()=>[...a.map((t=>o(R,{span:24,key:t},(()=>[o("div",{onClick:e=>((e,t)=>{e.target.classList.contains("el-tag__close")||we("tags",t)})(e,t)},[o(V,{closable:!0,onClose:()=>(async(e,t)=>{e.tags||(e.tags=[]);const l=e.tags.indexOf(t);l>-1&&e.tags.splice(l,1),await q(e.id,Y,t)})(e,t)},(()=>t))])])))),o(R,{span:24},i.inputVisible?()=>o(s,{ref:i.inputRef,modelValue:i.inputValue,"onUpdate:modelValue":e=>i.inputValue=e,class:"w-20",size:"small",onKeyup:e=>{"Enter"===e.key&&n()},onBlur:n}):()=>o(r,{class:"button-new-tag",size:"small",onClick:()=>(i.inputVisible=!0,void _((()=>{})))},(()=>"+ New Tag")))]))},minWidth:"130"},{field:"time",label:y("asset.time"),minWidth:200},{field:"action",label:y("tableDemo.action"),formatter:(e,t,l)=>{let i;return a(p,null,[a(n,{type:"primary",onClick:()=>be(e)},B(i=y("asset.detail"))?i:{default:()=>[i]}),a(n,{type:"success",onClick:()=>Ve(e.vulnid)},{default:()=>[u("POC")]})])},minWidth:100}]);let Y="vulnerability";X.forEach((e=>{e.hidden=e.hidden??!1}));let Z=t(!1);const ee=({field:e,hidden:t})=>{const l=X.findIndex((t=>t.field===e));-1!==l&&(X[l].hidden=t),(()=>{const e=X.reduce(((e,t)=>(e[t.field]=t.hidden,e)),{});e.statisticsHidden=Z.value,localStorage.setItem(`columnConfig_${Y}`,JSON.stringify(e))})()};(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${Y}`)||"{}");X.forEach((t=>{void 0!==e[t.field]&&"select"!=t.field&&(t.hidden=e[t.field])})),Z.value=e.statisticsHidden})();const{allSchemas:te}=D(X),{tableRegister:le,tableState:ae,tableMethods:ie}=S({fetchDataApi:async()=>{const{currentPage:e,pageSize:t}=ae,l=await((e,t,l,a)=>F.post({url:"/api/assets/vulnerability",data:{search:e,pageIndex:t,pageSize:l,filter:a}}))(J.value,e.value,t.value,xe);return{list:l.data.list,total:l.data.total}},immediate:!1}),{loading:oe,dataList:se,total:re,currentPage:ne,pageSize:ue}=ae,{getList:pe,getElTableExpose:ce}=ie;function de(){return{background:"var(--el-fill-color-light)"}}ue.value=20,c((()=>{ve(),window.addEventListener("resize",ve)}));const me=t(0),ve=()=>{const e=window.innerHeight||document.documentElement.clientHeight;me.value=.7*e},ge=l({URL:"",Vulnerability:"",Level:"",Matched:"",Time:"",Request:"",Response:""}),he=t(""),fe=t(!1),be=async e=>{const t=e.level;he.value="";let l="";"critical"===t?(he.value="red",l=y("poc.critical")):"high"===t?(he.value="orange",l=y("poc.high")):"medium"===t?(he.value="yellow",l=y("poc.medium")):"low"===t?(he.value="blue",l=y("poc.low")):"info"===t?(he.value="green",l=y("poc.info")):"unknown"===t&&(he.value="gray",l=y("poc.unknown"));const a=await(i=e.hash,F.post({url:"/api/assets/vulnerability/detail",data:{hash:i}}));var i;ge.Level=l,ge.Vulnerability=e.vulnerability,ge.Matched=e.matched,ge.Time=e.time,ge.URL=e.url,ge.Request=a.data.req,ge.Response=a.data.res,fe.value=!0},xe=l({}),ye=async e=>{Object.assign(xe,e),pe()},je=(e,t)=>{Object.assign(xe,t),J.value=e,pe()},_e=t([]),we=(e,t)=>{const l=`${e}=${t}`;_e.value=[..._e.value,l]},Se=e=>{if(_e.value){const[t,l]=e.split("=");t in xe&&Array.isArray(xe[t])&&(xe[t]=xe[t].filter((e=>e!==l)),0===xe[t].length&&delete xe[t]),_e.value=_e.value.filter((t=>t!==e))}};let ke=l({id:"",name:"",level:"",content:"",tags:[]});const Ce=t(!1),Ve=async e=>{ke.id="",ke.name="",ke.level="",ke.content="",ke.tags=[];const t=await $(e);ke.id=t.data.id,ke.name=t.data.name,ke.level=t.data.level,ke.content=t.data.content,ke.tags=t.data.tags,Ce.value=!0},Ee=()=>{Ce.value=!1},Le=()=>xe;return(e,t)=>{const l=d("ElScrollbar");return m(),v(p,null,[a(O,{getList:g(pe),handleSearch:G,searchKeywordsData:w,index:"vulnerability",getElTableExpose:g(ce),handleFilterSearch:je,projectList:e.$props.projectList,crudSchemas:X,dynamicTags:_e.value,handleClose:Se,onUpdateColumnVisibility:ee,searchResultCount:g(re),getFilter:Le},null,8,["getList","getElTableExpose","projectList","crudSchemas","dynamicTags","searchResultCount"]),a(g(H),null,{default:h((()=>[a(g(R),null,{default:h((()=>[a(g(k),null,{default:h((()=>[a(g(I),{pageSize:g(ue),"onUpdate:pageSize":t[0]||(t[0]=e=>f(ue)?ue.value=e:null),currentPage:g(ne),"onUpdate:currentPage":t[1]||(t[1]=e=>f(ne)?ne.value=e:null),columns:g(te).tableColumns,data:g(se),stripe:"",border:!0,"max-height":me.value,loading:g(oe),resizable:!0,onRegister:g(le),onFilterChange:ye,headerCellStyle:de,style:{fontFamily:"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji"}},null,8,["pageSize","currentPage","columns","data","max-height","loading","onRegister"])])),_:1})])),_:1}),a(g(R),{":span":24},{default:h((()=>[a(g(k),null,{default:h((()=>[a(g(C),{pageSize:g(ue),"onUpdate:pageSize":t[2]||(t[2]=e=>f(ue)?ue.value=e:null),currentPage:g(ne),"onUpdate:currentPage":t[3]||(t[3]=e=>f(ne)?ne.value=e:null),"page-sizes":[20,50,100,200,500,1e3],layout:"total, sizes, prev, pager, next, jumper",total:g(re)},null,8,["pageSize","currentPage","total"])])),_:1})])),_:1})])),_:1}),a(g(A),{modelValue:fe.value,"onUpdate:modelValue":t[4]||(t[4]=e=>fe.value=e),title:g(y)("asset.detail"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},width:"70%","max-height":me.value},{default:h((()=>[a(g(z),{border:!0,column:2,style:{"word-break":"break-word"}},{default:h((()=>[a(g(T),{label:"URL",span:2},{default:h((()=>[u(b(ge.URL),1)])),_:1}),a(g(T),{label:"Level"},{default:h((()=>[a(g(i),{icon:"clarity:circle-solid",color:he.value},null,8,["color"]),a(g(U),{type:"info"},{default:h((()=>[u(b(ge.Level),1)])),_:1})])),_:1}),a(g(T),{label:"Vulnerability"},{default:h((()=>[u(b(ge.Vulnerability),1)])),_:1}),a(g(T),{label:"Matched"},{default:h((()=>[u(b(ge.Matched),1)])),_:1}),a(g(T),{label:"Time"},{default:h((()=>[u(b(ge.Time),1)])),_:1}),a(g(T),{label:"Request"},{default:h((()=>[a(l,{"max-height":me.value,"max-width":"maxHeight"},{default:h((()=>[x("div",N,b(ge.Request),1)])),_:1},8,["max-height"])])),_:1}),a(g(T),{label:"Response"},{default:h((()=>[a(l,{"max-height":me.value},{default:h((()=>[x("div",K,b(ge.Response),1)])),_:1},8,["max-height"])])),_:1})])),_:1})])),_:1},8,["modelValue","title","max-height"]),a(g(A),{modelValue:Ce.value,"onUpdate:modelValue":t[5]||(t[5]=e=>Ce.value=e),title:g(ke).id?e.$t("common.edit"):e.$t("common.new"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},maxHeight:800},{default:h((()=>[a(M,{closeDialog:Ee,pocForm:g(ke),getList:g(pe)},null,8,["pocForm","getList"])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-028353cd"]]);export{J as default};
