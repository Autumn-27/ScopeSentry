import{P as e,g as a,U as t}from"./PanelGroup-CDdcfikb.js";import{d as l,r as s,s as o,v as r,x as n,y as m,o as i,c as d,e as u,w as p,a as c,f,t as v,i as g,z as h,j as _,A as b,B as y,F as x,l as j,_ as k}from"./index-DZkrNvQC.js";import{E as w,a as N}from"./el-col-s8XiVykl.js";import{E as V}from"./el-card-DJlZ0CLo.js";import{E as S}from"./el-progress-Bqw48UfU.js";import{E as A}from"./el-text-DhQDCxty.js";import"./el-tooltip-l0sNRNKZ.js";import{E as C}from"./el-popper-VZvChD93.js";import{E as I,a as U}from"./el-form-BfI3XjdN.js";import{_ as E}from"./Table.vue_vue_type_script_lang-Dkl0dTPC.js";import{E as F}from"./el-tag-BLiRkvOU.js";import{_ as z}from"./Dialog.vue_vue_type_style_index_0_lang-CN4G-oAc.js";import{g as T}from"./index-DcAyUTv-.js";import{g as P}from"./index-BmUPBzHH.js";import{c as B}from"./index-CcNl0Xcx.js";import"./el-skeleton-item-CQgbNmiv.js";import"./CountTo.vue_vue_type_script_setup_true_lang-XVdhhLHJ.js";import"./index-D7sIarE1.js";import"./castArray-M4B-XqAz.js";import"./el-table-column-Cf4Hjyif.js";import"./index-0WqnF4zs.js";import"./debounce-ZoOD6Jtd.js";import"./el-checkbox-DD3shB1l.js";import"./isArrayLikeObject-DI26AvnP.js";import"./raf-D_pBdXgG.js";import"./el-pagination-8Xi09ZRF.js";import"./el-select-Cg9roJ9C.js";import"./strings-6KyoKaer.js";import"./useInput-DMGD1XhZ.js";import"./el-image-viewer-DNoNmynu.js";import"./el-empty-bmuKy-Tq.js";import"./tsxHelper-DrSyVvbf.js";import"./el-dropdown-item-BykouGbZ.js";import"./refs-VHbxD1oy.js";import"./index-CFOhGeju.js";const H={class:"flex flex-col gap-2"},G=k(l({__name:"Analysis",setup(l){const{t:k}=j(),G=s(!0),L=o([{field:"name",label:k("node.nodeName")},{field:"running",label:k("node.taskCount"),formatter:(e,a,t)=>r(F,{round:!0,effect:"dark"},(()=>t))},{field:"finished",label:k("node.finished"),formatter:(e,a,t)=>r(F,{round:!0,effect:"dark"},(()=>t))},{field:"state",label:k("node.nodeStatus"),formatter:(e,a,t)=>r(F,{type:"1"===t?"success":"2"===t?"warning":"danger",effect:"dark"},(()=>k("1"==t?"node.statusRun":"2"==t?"node.statusStop":"node.statusError")))}]),M=o([{field:"name",label:k("task.taskName")},{field:"taskNum",label:k("task.taskCount"),formatter:(e,a,t)=>r(F,{round:!0,effect:"dark"},(()=>t))},{field:"progress",label:k("task.taskProgress"),formatter:(e,a,t)=>r(S,{percentage:t,type:"line",striped:!0,status:t<100?"":"success",stripedFlow:t<100})},{field:"creatTime",label:k("task.createTime")}]),O=o([{field:"name",label:k("node.nodeName")},{field:"cpuNum",label:k("node.nodeUsageCpu"),formatter:(e,a,t)=>{let l=parseFloat(t);return l=parseFloat(l.toFixed(2)),r(S,{percentage:l,type:"dashboard",color:l<50?"#26a33f":l<=80?"#fe9900":"#df2800"})}},{field:"memNum",label:k("node.nodeUsageMemory"),formatter:(e,a,t)=>{let l=parseFloat(t);return l=parseFloat(l.toFixed(2)),r(S,{percentage:l,type:"dashboard",color:l<50?"#26a33f":l<80?"#fe9900":"#df2800"})}}]),R=o([{field:"name",label:k("common.name")},{field:"cversion",label:k("common.cversion")},{field:"lversion",label:k("common.lversion"),formatter:(e,a,t)=>{if(e.cversion!=e.lversion){ee.value=!0;const a=e.msg.split("\\n");let l="";return a.forEach((e=>{l+=`<div>${e}</div>`})),r(C,{placement:"top",content:l,rawContent:!0},[r(A,{type:"danger"},t)])}return r(A,t)}}]);let $=s([]);const D=s([]),J=async()=>{try{const e=await T();e&&e.data&&Array.isArray(e.data.list)&&(D.value=e.data.list.map((e=>({name:e.name,running:e.running,state:e.state,finished:e.finished,cpuNum:e.cpuNum,memNum:e.memNum}))),$.value=o(e.data.list.map((e=>({name:e.name,cpuNum:e.cpuNum,memNum:e.memNum})))))}catch(e){}finally{G.value=!1}},q=s([]),K=async()=>{const e=await P("",1,10);q.value=o(e.data.list.map((e=>({name:e.name,taskNum:e.taskNum,progress:e.progress,creatTime:e.creatTime}))))},Q=s([]),W=async()=>{await Promise.all([J(),K()]),G.value=!1};(async()=>{const e=await a();Q.value=o(e.data.list.map((e=>({name:e.name,cversion:e.cversion,lversion:e.lversion,msg:e.msg}))))})(),W();const X=setInterval(W,1e4);n((()=>{clearInterval(X)}));const Y=s(""),Z=async()=>{if(Y.value){200==(await B(Y.value)).code&&(localStorage.setItem("plugin_key",Y.value),le.value=!1,te.value=!0)}},ee=s(!1),ae=s({server:"https://github.com/Autumn-27/ScopeSentry/archive/refs/heads/main.zip",scan:""}),te=s(!1),le=s(!1);async function se(){const e=localStorage.getItem("plugin_key");505==(await t(ae.value.server,ae.value.scan,e)).code&&localStorage.removeItem("plugin_key")}return(a,t)=>{const l=m("BaseButton");return i(),d(x,null,[u(e),u(c(N),{gutter:20,justify:"space-between"},{default:p((()=>[u(c(w),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[u(c(V),{shadow:"hover",class:"mb-20px"},{header:p((()=>[f("span",null,v(c(k)("dashboard.nodeInfo")),1)])),default:p((()=>[u(c(E),{columns:L,data:D.value,stripe:"",border:!1,height:250},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{xl:12,lg:12,md:24,sm:24,xs:24},{default:p((()=>[u(c(V),{shadow:"hover",class:"mb-20px"},{header:p((()=>[f("span",null,v(c(k)("dashboard.taskInfo")),1)])),default:p((()=>[u(c(E),{columns:M,data:q.value,stripe:"",border:!1,height:250,"tooltip-options":{offset:1,showArrow:!1,effect:"dark",enterable:!1,showAfter:0,popperOptions:{},popperClass:"test",placement:"bottom",hideAfter:0,disabled:!0}},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{span:12},{default:p((()=>[u(c(V),{shadow:"hover",class:"mb-25px"},{header:p((()=>[f("div",null,[f("span",null,v(c(k)("node.nodeUsageStatus")),1)])])),default:p((()=>[u(c(E),{columns:O,data:c($),highlightCurrentRow:!1,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1}),u(c(w),{span:12},{default:p((()=>[u(c(V),{shadow:"hover",class:"mb-25px"},{header:p((()=>[u(c(N),null,{default:p((()=>[u(c(w),{span:12},{default:p((()=>[f("div",null,[f("span",null,v(c(k)("common.version")),1),ee.value?(i(),g(c(A),{key:0,type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[h("*"+v(c(k)("common.updatemsg")),1)])),_:1})):_("",!0)])])),_:1})])),_:1})])),default:p((()=>[u(c(E),{columns:R,data:Q.value,stripe:"",border:!1,height:600},null,8,["columns","data"])])),_:1})])),_:1})])),_:1}),u(c(z),{modelValue:te.value,"onUpdate:modelValue":t[2]||(t[2]=e=>te.value=e),title:"Update",center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"},maxHeight:430},{default:p((()=>[u(c(A),{type:"danger",size:"small",style:{position:"relative",left:"1rem"}},{default:p((()=>[h("*更新目前只支持docker容器搭建的程序，输入的url地址确保docker内可访问，节点最新版在github中releases的linux版本")])),_:1}),u(c(I),{model:ae.value,"label-width":"120px",class:"upload-form"},{default:p((()=>[u(c(U),{label:"server url"},{default:p((()=>[u(c(b),{modelValue:ae.value.server,"onUpdate:modelValue":t[0]||(t[0]=e=>ae.value.server=e),placeholder:"server url"},null,8,["modelValue"])])),_:1}),u(c(U),{label:"scan url"},{default:p((()=>[u(c(b),{modelValue:ae.value.scan,"onUpdate:modelValue":t[1]||(t[1]=e=>ae.value.scan=e),placeholder:"scan url(https://github.com/Autumn-27/ScopeSentry-Scan/releases/download/vx.x.x/ScopeSentry-Scan_linux_amd64_vx.x.x.zip)"},null,8,["modelValue"])])),_:1}),u(c(U),null,{default:p((()=>[u(c(y),{type:"primary",onClick:se},{default:p((()=>[h("Submit")])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue"]),u(c(z),{modelValue:le.value,"onUpdate:modelValue":t[4]||(t[4]=e=>le.value=e),title:c(k)("plugin.key"),center:"",width:"30%",style:{"max-width":"400px",height:"200px"}},{default:p((()=>[f("div",H,[u(c(C),{class:"item",effect:"dark",content:c(k)("plugin.keyMsg"),placement:"top"},{default:p((()=>[u(c(b),{modelValue:Y.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Y.value=e)},null,8,["modelValue"])])),_:1},8,["content"]),u(l,{onClick:Z,type:"primary",class:"w-full"},{default:p((()=>[h("确定")])),_:1})])])),_:1},8,["modelValue","title"])],64)}}}),[["__scopeId","data-v-72a960be"]]);export{G as default};
