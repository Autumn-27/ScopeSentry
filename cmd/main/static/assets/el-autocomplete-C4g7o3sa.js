import{Y as e,Z as a,aU as t,a0 as l,a3 as s,bt as o,a1 as u,br as n,d as i,cp as r,aA as p,bb as v,a7 as d,r as c,aS as f,a8 as g,aH as m,H as b,o as h,i as y,w as $,f as x,n as S,a as w,aI as A,e as k,E as F,c as _,a9 as B,C as I,aQ as C,F as E,Q as K,z as R,t as T,A as W,aK as H,ae as N,af as U,bR as V,aa as j,a4 as q,bv as z,ah as O}from"./index-nzltsnmL.js";import{u as L,E as P}from"./el-popper-C3_PYh3k.js";import{d as Q}from"./debounce-D4bP7E3J.js";const D=e({valueKey:{type:String,default:"value"},modelValue:{type:[String,Number],default:""},debounce:{type:Number,default:300},placement:{type:a(String),values:["top","top-start","top-end","bottom","bottom-start","bottom-end"],default:"bottom-start"},fetchSuggestions:{type:a([Function,Array]),default:t},popperClass:{type:String,default:""},triggerOnFocus:{type:Boolean,default:!0},selectWhenUnmatched:{type:Boolean,default:!1},hideLoading:{type:Boolean,default:!1},label:{type:String},teleported:L.teleported,highlightFirstItem:{type:Boolean,default:!1},fitInputWidth:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},name:String}),J={[l]:e=>s(e),[o]:e=>s(e),[u]:e=>s(e),focus:e=>e instanceof FocusEvent,blur:e=>e instanceof FocusEvent,clear:()=>!0,select:e=>n(e)},M=["aria-expanded","aria-owns"],Y={key:0},Z=["id","aria-selected","onClick"],G="ElAutocomplete",X=i({name:G,inheritAttrs:!1});const ee=O(j(i({...X,props:D,emits:J,setup(e,{expose:a,emit:t}){const s=e,n=r(),i=p(),j=v(),O=d("autocomplete"),L=c(),D=c(),J=c(),X=c();let ee=!1,ae=!1;const te=c([]),le=c(-1),se=c(""),oe=c(!1),ue=c(!1),ne=c(!1),ie=f(),re=g((()=>i.style)),pe=g((()=>(te.value.length>0||ne.value)&&oe.value)),ve=g((()=>!s.hideLoading&&ne.value)),de=g((()=>L.value?Array.from(L.value.$el.querySelectorAll("input")):[])),ce=()=>{pe.value&&(se.value=`${L.value.$el.offsetWidth}px`)},fe=()=>{le.value=-1},ge=Q((async e=>{if(ue.value)return;const a=e=>{ne.value=!1,ue.value||(q(e)?(te.value=e,le.value=s.highlightFirstItem?0:-1):z(G,"autocomplete suggestions must be an array"))};if(ne.value=!0,q(s.fetchSuggestions))a(s.fetchSuggestions);else{const t=await s.fetchSuggestions(e,a);q(t)&&a(t)}}),s.debounce),me=e=>{const a=!!e;if(t(o,e),t(l,e),ue.value=!1,oe.value||(oe.value=a),!s.triggerOnFocus&&!e)return ue.value=!0,void(te.value=[]);ge(e)},be=e=>{var a;j.value||("INPUT"!==(null==(a=e.target)?void 0:a.tagName)||de.value.includes(document.activeElement))&&(oe.value=!0)},he=e=>{t(u,e)},ye=e=>{ae?ae=!1:(oe.value=!0,t("focus",e),s.triggerOnFocus&&!ee&&ge(String(s.modelValue)))},$e=e=>{setTimeout((()=>{var a;(null==(a=J.value)?void 0:a.isFocusInsideContent())?ae=!0:(oe.value&&Ae(),t("blur",e))}))},xe=()=>{oe.value=!1,t(l,""),t("clear")},Se=async()=>{pe.value&&le.value>=0&&le.value<te.value.length?ke(te.value[le.value]):s.selectWhenUnmatched&&(t("select",{value:s.modelValue}),te.value=[],le.value=-1)},we=e=>{pe.value&&(e.preventDefault(),e.stopPropagation(),Ae())},Ae=()=>{oe.value=!1},ke=async e=>{t(o,e[s.valueKey]),t(l,e[s.valueKey]),t("select",e),te.value=[],le.value=-1},Fe=e=>{if(!pe.value||ne.value)return;if(e<0)return void(le.value=-1);e>=te.value.length&&(e=te.value.length-1);const a=D.value.querySelector(`.${O.be("suggestion","wrap")}`),t=a.querySelectorAll(`.${O.be("suggestion","list")} li`)[e],l=a.scrollTop,{offsetTop:s,scrollHeight:o}=t;s+o>l+a.clientHeight&&(a.scrollTop+=o),s<l&&(a.scrollTop-=o),le.value=e,L.value.ref.setAttribute("aria-activedescendant",`${ie.value}-item-${le.value}`)};return m(X,(()=>{pe.value&&Ae()})),b((()=>{L.value.ref.setAttribute("role","textbox"),L.value.ref.setAttribute("aria-autocomplete","list"),L.value.ref.setAttribute("aria-controls","id"),L.value.ref.setAttribute("aria-activedescendant",`${ie.value}-item-${le.value}`),ee=L.value.ref.hasAttribute("readonly")})),a({highlightedIndex:le,activated:oe,loading:ne,inputRef:L,popperRef:J,suggestions:te,handleSelect:ke,handleKeyEnter:Se,focus:()=>{var e;null==(e=L.value)||e.focus()},blur:()=>{var e;null==(e=L.value)||e.blur()},close:Ae,highlight:Fe}),(e,a)=>(h(),y(w(P),{ref_key:"popperRef",ref:J,visible:w(pe),placement:e.placement,"fallback-placements":["bottom-start","top-start"],"popper-class":[w(O).e("popper"),e.popperClass],teleported:e.teleported,"gpu-acceleration":!1,pure:"","manual-mode":"",effect:"light",trigger:"click",transition:`${w(O).namespace.value}-zoom-in-top`,persistent:"",role:"listbox",onBeforeShow:ce,onHide:fe},{content:$((()=>[x("div",{ref_key:"regionRef",ref:D,class:S([w(O).b("suggestion"),w(O).is("loading",w(ve))]),style:A({[e.fitInputWidth?"width":"minWidth"]:se.value,outline:"none"}),role:"region"},[k(w(F),{id:w(ie),tag:"ul","wrap-class":w(O).be("suggestion","wrap"),"view-class":w(O).be("suggestion","list"),role:"listbox"},{default:$((()=>[w(ve)?(h(),_("li",Y,[B(e.$slots,"loading",{},(()=>[k(w(I),{class:S(w(O).is("loading"))},{default:$((()=>[k(w(C))])),_:1},8,["class"])]))])):(h(!0),_(E,{key:1},K(te.value,((a,t)=>(h(),_("li",{id:`${w(ie)}-item-${t}`,key:t,class:S({highlighted:le.value===t}),role:"option","aria-selected":le.value===t,onClick:e=>ke(a)},[B(e.$slots,"default",{item:a},(()=>[R(T(a[e.valueKey]),1)]))],10,Z)))),128))])),_:3},8,["id","wrap-class","view-class"])],6)])),default:$((()=>[x("div",{ref_key:"listboxRef",ref:X,class:S([w(O).b(),e.$attrs.class]),style:A(w(re)),role:"combobox","aria-haspopup":"listbox","aria-expanded":w(pe),"aria-owns":w(ie)},[k(w(W),H({ref_key:"inputRef",ref:L},w(n),{clearable:e.clearable,disabled:w(j),name:e.name,"model-value":e.modelValue,onInput:me,onChange:he,onFocus:ye,onBlur:$e,onClear:xe,onKeydown:[a[0]||(a[0]=N(U((e=>Fe(le.value-1)),["prevent"]),["up"])),a[1]||(a[1]=N(U((e=>Fe(le.value+1)),["prevent"]),["down"])),N(Se,["enter"]),N(Ae,["tab"]),N(we,["esc"])],onMousedown:be}),V({_:2},[e.$slots.prepend?{name:"prepend",fn:$((()=>[B(e.$slots,"prepend")]))}:void 0,e.$slots.append?{name:"append",fn:$((()=>[B(e.$slots,"append")]))}:void 0,e.$slots.prefix?{name:"prefix",fn:$((()=>[B(e.$slots,"prefix")]))}:void 0,e.$slots.suffix?{name:"suffix",fn:$((()=>[B(e.$slots,"suffix")]))}:void 0]),1040,["clearable","disabled","name","model-value","onKeydown"])],14,M)])),_:3},8,["visible","placement","popper-class","teleported","transition"]))}}),[["__file","autocomplete.vue"]]));export{ee as E};
