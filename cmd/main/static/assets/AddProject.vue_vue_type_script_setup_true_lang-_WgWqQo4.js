import{d as e,s as a,a8 as l,r as t,H as o,o as r,c as s,e as d,w as u,a as n,A as i,B as g,z as p,t as c,F as m,l as f,M as h}from"./index-BtXGhrg7.js";import{E as j}from"./el-divider-X-NzzOtk.js";import{a as v,E as _}from"./el-form-CUqPd1V-.js";import{a as b,E as x}from"./el-col-DYZWZCh_.js";import{b as y,u as V,c as k}from"./index-C5T6-z9a.js";import{a as w}from"./index-BYX49Yb-.js";import{_ as T}from"./Dialog.vue_vue_type_style_index_0_lang-CjxBMPuV.js";import{h as P}from"./index-Du3Gp4PM.js";import D from"./DetailTemplate-C4it11Cn.js";const N=e({__name:"AddProject",props:{closeDialog:{type:Function},projectid:{},getProjectData:{type:Function},schedule:{type:Boolean}},setup(e){const{t:N}=f();let q=a({name:"",tag:"",logo:"",target:"",ignore:"",scheduledTasks:!1,hour:24,node:[],allNode:!1,duplicates:"None",template:""});const U=e,E=l((()=>{const e={name:[{required:!0,message:N("project.msgProject"),trigger:"blur"}],tag:[{required:!0,message:N("project.msgProjectTag"),trigger:"blur"}],target:[{required:!0,message:N("project.msgProjectScope"),trigger:"blur"}],node:[{required:!1,message:N("task.nodeMsg"),trigger:"blur"}],template:[{required:!0,message:"Please select template",trigger:"blur"}]};return q.scheduledTasks&&(e.node=[{required:!0,message:N("task.nodeMsg"),trigger:"blur"}]),e})),M=t(!1),F=t(),A=t(!1),R=t(!1);t(!1);const z=t(!1),B=a([]),L=a([]),S=async()=>{L.length=0;const e=await P("",1,1e3);e.data.list.length>0&&e.data.list.forEach((e=>{L.push({value:e.id,label:e.name})}))};o((()=>{(async()=>{if(""!=U.projectid){R.value=!0;const e=await k(U.projectid);q.name=e.data.name,q.tag=e.data.tag,q.target=e.data.target,q.logo=e.data.logo,q.scheduledTasks=e.data.scheduledTasks,q.hour=e.data.hour,q.allNode=e.data.allNode,q.node=e.data.node,q.duplicates=e.data.duplicates,q.ignore=e.data.ignore,q.template=e.data.template,R.value=!1}})(),(async()=>{const e=await w();e.data.list.length>0?(z.value=!1,e.data.list.forEach((e=>{B.push({value:e,label:e})}))):(z.value=!0,h.warning(N("node.onlineNodeMsg")))})(),S()}));const C=t("");const G=t(!1),H=()=>{G.value=!1};return(e,a)=>(r(),s(m,null,[d(n(_),{model:n(q),"label-width":"auto",rules:E.value,"status-icon":"",ref_key:"ruleFormRef",ref:F,loading:R.value},{default:u((()=>[d(n(v),{label:n(N)("project.projectName"),prop:"name"},{default:u((()=>[d(n(i),{modelValue:n(q).name,"onUpdate:modelValue":a[0]||(a[0]=e=>n(q).name=e),placeholder:n(N)("project.msgProject")},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(n(v),{label:"TAG",prop:"tag"},{default:u((()=>[d(n(i),{modelValue:n(q).tag,"onUpdate:modelValue":a[1]||(a[1]=e=>n(q).tag=e),placeholder:n(N)("project.msgProjectTag")},null,8,["modelValue","placeholder"])])),_:1}),d(n(v),{label:n(N)("project.projectScope"),prop:"target"},{default:u((()=>[d(n(i),{modelValue:n(q).target,"onUpdate:modelValue":a[2]||(a[2]=e=>n(q).target=e),placeholder:n(N)("task.msgTarget"),type:"textarea",autosize:{minRows:6,maxRows:15}},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(n(v),{label:n(N)("task.ignore"),prop:"ignore"},{default:u((()=>[d(n(i),{modelValue:n(q).ignore,"onUpdate:modelValue":a[3]||(a[3]=e=>n(q).ignore=e),placeholder:n(N)("task.ignoreMsg"),type:"textarea",rows:"10"},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),d(n(v),{label:"Logo",prop:"logo"},{default:u((()=>[d(n(i),{modelValue:n(q).logo,"onUpdate:modelValue":a[4]||(a[4]=e=>n(q).logo=e),placeholder:"http(s)://xxxxx.xx"},null,8,["modelValue"])])),_:1}),d(n(j)),d(n(b),null,{default:u((()=>[d(n(x),{span:2,offset:12},{default:u((()=>[d(n(v),null,{default:u((()=>[d(n(g),{type:"primary",onClick:a[5]||(a[5]=e=>(async e=>{M.value=!0,e&&(await e.validate((async(e,a)=>{if(e)if(""==U.projectid)try{200===(await y(A.value,q.name,q.tag,q.target,q.logo,q.scheduledTasks,q.hour,q.allNode,q.node,q.duplicates,q.ignore,q.template)).code&&U.closeDialog()}finally{M.value=!1}else try{200===(await V(A.value,U.projectid,q.name,q.tag,q.target,q.logo,q.scheduledTasks,q.hour,q.allNode,q.node,q.duplicates,q.ignore,q.template)).code&&U.closeDialog()}finally{M.value=!1}else M.value=!1})),U.getProjectData(1,50))})(F.value)),loading:M.value},{default:u((()=>[p(c(n(N)("task.save")),1)])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules","loading"]),d(n(T),{modelValue:G.value,"onUpdate:modelValue":a[6]||(a[6]=e=>G.value=e),title:n(""),center:"",fullscreen:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:u((()=>[d(D,{closeDialog:H,getList:S,id:C.value},null,8,["id"])])),_:1},8,["modelValue","title"])],64))}});export{N as _};
