import{_ as e}from"./ContentWrap.vue_vue_type_script_setup_true_lang-CdgQJdxL.js";import{d as a,dC as t,s as l,r as s,a5 as o,o as i,c as n,e as r,w as p,a as c,B as d,f as u,t as m,z as g,C as v,F as f,Q as h,i as y,j as _,R as x,n as j,l as b,K as k,M as w,_ as S}from"./index-nzltsnmL.js";import{a as C,E as V}from"./el-col-DJlh4lr9.js";import{E as H,a as F}from"./el-table-column-Cuc8FUTA.js";import"./el-checkbox-BhyFD5d3.js";import"./el-tooltip-l0sNRNKZ.js";import"./el-popper-C3_PYh3k.js";import{E as $}from"./el-tag-DPyDCZlw.js";import{E}from"./el-text-CqxCjSE-.js";import{E as T}from"./el-divider-C8yVivIF.js";import{E as A}from"./el-autocomplete-C4g7o3sa.js";import{b as L,E as z,a as D}from"./el-dropdown-item-CLiBAw7Z.js";import"./el-select-Bs0PD9X-.js";/* empty css                */import{E as I}from"./el-tree-select-sk_7OPxn.js";import{E as U}from"./el-switch-BavDDgrt.js";import{_ as N}from"./Dialog.vue_vue_type_style_index_0_lang-DA7lMsw7.js";import{u as O}from"./useIcon-B9cmGcjH.js";import{_ as R}from"./exportData.vue_vue_type_script_setup_true_lang-prhJVTa5.js";import{A as B}from"./index-D4HWP-wZ.js";import{_ as K}from"./AddTask.vue_vue_type_script_setup_true_lang-BJ_rGJCk.js";import"./el-card-Eu35f0zk.js";import"./index-CrGFPoUA.js";import"./debounce-D4bP7E3J.js";import"./isArrayLikeObject-D3T_EJxY.js";import"./raf-C2dKvd0t.js";import"./el-pagination-Dhl9UEGP.js";import"./castArray-DGKkC14W.js";import"./refs-BmVAq2gM.js";import"./strings-Daoqk9NI.js";import"./useInput-7e-6bNxT.js";import"./index-CMgqj8vQ.js";import"./el-tab-pane-D36yAUzQ.js";import"./el-form-zVeqBxrz.js";import"./el-radio-group-BMeEUyun.js";import"./el-space-DuSMzOb2.js";/* empty css                          */import"./index-tixjvWVY.js";import"./Table.vue_vue_type_script_lang-BsFFsMQE.js";import"./el-image-viewer-LaK7qmMn.js";import"./el-empty--O0TYBY2.js";import"./tsxHelper-CvPQkQ0D.js";import"./index-CwHJqKb5.js";import"./useTable-4MqqCPsq.js";import"./el-virtual-list-BX68mbBi.js";import"./el-select-v2-BNgePoIr.js";import"./index-EDtAyMUM.js";import"./index-VOgm_Que.js";import"./DetailTemplate-B0qe6Qsp.js";import"./index-bBy2mDbN.js";import"./index-Bq2K_tUD.js";import"./index-CQ-lmjrI.js";const P={style:{float:"left"}},W={style:{float:"right",color:"var(--el-text-color-secondary)","font-size":"13px"}},J={class:"custom-dropdown"},q={key:0,class:"dropdown-item"},M={class:"label-text"},Q={class:"label-text"},G={class:"segment-control"},X={class:"flex gap-2",style:{"flex-wrap":"wrap"}},Y={style:{color:"#888"}},Z={style:{"font-weight":"bold",color:"#333333"}},ee={style:{color:"#888"}},ae=["src","alt"],te=S(a({__name:"Csearch",props:{getList:{type:Function},handleSearch:{type:Function},searchKeywordsData:{},index:{},getElTableExpose:{type:Function},handleFilterSearch:{type:Function},projectList:{},dynamicTags:{},handleClose:{type:Function},openAggregation:{type:Function},crudSchemas:{},statisticsHidden:{type:Boolean},changeStatisticsHidden:{type:Function},searchResultCount:{},sensitiveAllNumber:{},activeSegment:{},setActiveSegment:{type:Function},getFilter:{type:Function},iconData:{}},emits:["update-column-visibility"],setup(a,{emit:S}){const{t:te}=b(),{query:le}=t(),se=a,oe=l([...se.searchKeywordsData]),ie={keyword:"task",example:'task=="test"',explain:te("searchHelp.taskName")};oe.push(ie),oe.push({keyword:"tag",example:'tag=="test"',explain:"find tags"});const ne=[{operator:"=",meaning:te("searchHelp.like"),value:'=""'},{operator:"!=",meaning:te("searchHelp.notIn"),value:'!=""'},{operator:"==",meaning:te("searchHelp.equal"),value:'==""'}],re=[{operator:"&&",meaning:te("searchHelp.and"),value:"&&",logic:"1"},{operator:"||",meaning:te("searchHelp.or"),value:"||",logic:"1"},{operator:"()",meaning:te("searchHelp.brackets"),value:"()",logic:"1"}],pe=ne.concat(re),ce=s(!1);(()=>{const e=JSON.parse(localStorage.getItem(`columnConfig_${se.index}`)||"{}");se.crudSchemas.forEach((a=>{void 0!==e[a.field]&&(a.hidden=e[a.field])}))})(),o((()=>se.crudSchemas),(()=>{(()=>{const e=se.crudSchemas.reduce(((e,a)=>("select"!=a.field&&(e[a.field]=a.hidden),e)),{});localStorage.setItem(`columnConfig_${se.index}`,JSON.stringify(e))})()}),{deep:!0});const de=()=>{ce.value=!0};function ue(){return{background:"var(--el-fill-color-light)"}}const me=s(""),ge=O({icon:"iconoir:search"}),ve=O({icon:"tdesign:chat-bubble-help"}),fe=O({icon:"ri:arrow-drop-down-line"}),he=O({icon:"ph:export-light"}),ye=O({icon:"carbon:data-vis-1"}),_e=O({icon:"openmoji:delete"}),xe=O({icon:"carbon:task-complete"}),je=s(!1),be=()=>{je.value=!0},ke=s([]),we=async()=>{const e=await se.getElTableExpose(),a=(null==e?void 0:e.getSelectionRows())||[];return ke.value=a.map((e=>e.id)),ke.value},Se=async()=>{k.confirm("Whether to delete?","Warning",{confirmButtonText:"OK",cancelButtonText:"Cancel",type:"warning"}).then((async()=>{await we(),await B(ke.value,se.index),se.getList()})).catch((()=>{w({type:"info",message:"Delete canceled"})}))},Ce=s(""),Ve=s(!1),He=s(!1);let Fe=s(!0),$e=s(!1),Ee=s(!1);const Te=(e,a)=>{if(Ce.value=e,""==e&&(Fe.value=!0,Ee.value=!1,$e.value=!1),Fe.value){Ee.value&&(e=e.replace(Ce.value,"").trim());a(oe.filter((a=>a.keyword.toLowerCase().includes(e.toLowerCase()))))}else if($e.value){const t=e.replace(Ce.value,"").trim();a(ne.filter((e=>e.operator.includes(t))))}else if(Ee.value&&e.endsWith(" ")){const t=e.replace(me.value,"").trim();a(re.filter((e=>e.operator.includes(t))))}else a([])},Ae=e=>{if(e.keyword){let a="";a=Ee.value?Ce.value+e.keyword:e.keyword,Ce.value=a,me.value=a,Ve.value=!0,Fe.value=!1,$e.value=!0}else e.logic?(me.value=`${Ce.value}${e.value}`,Ce.value=me.value,Fe.value=!0):(me.value=`${Ce.value}${e.value}`,Ce.value=me.value,He.value=!0,$e.value=!1,Ee.value=!0)},Le=s(!1),ze=s([]);o((()=>ze.value),(e=>{(async()=>{se.handleFilterSearch(me.value,{project:ze.value})})()}));const De=s(se.dynamicTags?[...se.dynamicTags]:[]),Ie=()=>{const e={};De.value.forEach((a=>{const[t,l]=a.split("=");t in e?e[t].push(l):e[t]=[l]})),e.project=ze.value,se.handleFilterSearch(me.value,e)};let Ue=le.task;void 0!==Ue&&""!==Ue&&De.value.push(`task=${Ue}`);const Ne=JSON.parse(localStorage.getItem("assetActiveSegment")||"{}");Ne&&Ne.activeSegment&&se.setActiveSegment&&se.setActiveSegment(Ne.activeSegment,!1),Ie(),o((()=>se.dynamicTags),(e=>{e?(De.value=[...e],void 0!==Ue&&""!==Ue&&De.value.push(`task=${Ue}`)):De.value=[],Ie()}),{immediate:!1});const Oe=S,Re=s(se.statisticsHidden),Be=()=>{location.reload()},Ke=O({icon:"icons8:insert-table"}),Pe=O({icon:"flowbite:grid-solid"});function We(e){se.setActiveSegment&&se.setActiveSegment(e,!0)}const Je=s(!1);let qe=te("task.addTask");const Me=()=>{Je.value=!1},Qe=async()=>{await we(),Je.value=!0};return(a,t)=>(i(),n(f,null,[r(c(e),null,{default:p((()=>[r(c(C),{class:"row-bg",gutter:20},{default:p((()=>[r(c(V),{span:6},{default:p((()=>[r(c(A),{modelValue:me.value,"onUpdate:modelValue":t[0]||(t[0]=e=>me.value=e),"fetch-suggestions":Te,placeholder:c(te)("form.input"),popperClass:"my-autocomplete",onSelect:Ae,style:{width:"100%"}},{append:p((()=>[r(c(d),{onClick:de,text:"",style:{display:"contents"},icon:c(ve)},null,8,["icon"])])),default:p((({item:e})=>[u("span",P,m(e.keyword||e.operator),1),u("span",W,m(e.explain||e.meaning),1)])),_:1},8,["modelValue","placeholder"])])),_:1}),r(c(V),{span:1.5},{default:p((()=>[r(c(d),{type:"primary",icon:c(ge),onClick:t[1]||(t[1]=e=>a.$props.handleSearch(me.value))},{default:p((()=>[g(m(c(te)("form.input")),1)])),_:1},8,["icon"])])),_:1}),r(c(V),{span:1.5},{default:p((()=>[r(c(d),{type:"primary",onClick:be,icon:c(he)},{default:p((()=>[g(m(c(te)("asset.export")),1)])),_:1},8,["icon"])])),_:1}),r(c(V),{span:4},{default:p((()=>[r(c(I),{loading:Le.value,modelValue:ze.value,"onUpdate:modelValue":t[2]||(t[2]=e=>ze.value=e),data:a.$props.projectList,placeholder:c(te)("project.project"),multiple:"",filterable:"","show-checkbox":"","collapse-tags":"","max-collapse-tags":1},null,8,["loading","modelValue","data","placeholder"])])),_:1}),r(c(V),{span:1.5,xs:1.5,sm:1.5,md:1.5},{default:p((()=>[r(c(L),{trigger:"click"},{dropdown:p((()=>[r(c(z),null,{default:p((()=>[r(c(D),{icon:c(_e),onClick:Se},{default:p((()=>[g(m(c(te)("common.delete")),1)])),_:1},8,["icon"]),r(c(D),{icon:c(xe),onClick:Qe},{default:p((()=>[g(m(c(te)("task.addTask")),1)])),_:1},8,["icon"])])),_:1})])),default:p((()=>[r(c(d),{plain:"",class:"custom-button align-bottom"},{default:p((()=>[g(m(c(te)("common.operation"))+" ",1),r(c(v),{class:"el-icon--right"},{default:p((()=>[r(c(fe))])),_:1})])),_:1})])),_:1})])),_:1}),r(c(V),{span:1,style:{display:"flex","align-items":"center"}},{default:p((()=>[r(c(L),null,{dropdown:p((()=>[r(c(z),null,{default:p((()=>[(i(!0),n(f,null,h(a.crudSchemas,((e,a)=>(i(),y(c(D),{key:a},{default:p((()=>["selection"!=e.field?(i(),n("div",q,[u("span",M,m(e.label),1),r(c(U),{size:"small",modelValue:e.hidden,"onUpdate:modelValue":a=>e.hidden=a,"active-value":!1,"inactive-value":!0,onChange:a=>(e=>{Oe("update-column-visibility",{field:e.field,hidden:e.hidden})})(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])])):_("",!0)])),_:2},1024)))),128)),"asset"==a.$props.index?(i(),y(c(D),{key:0},{default:p((()=>[u("span",Q,m(c(te)("asset.Chart")),1),r(c(U),{size:"small",modelValue:Re.value,"onUpdate:modelValue":t[3]||(t[3]=e=>Re.value=e),"active-value":!1,"inactive-value":!0,onChange:t[4]||(t[4]=e=>a.changeStatisticsHidden(Re.value))},null,8,["modelValue"])])),_:1})):_("",!0),r(c(D),{divided:""},{default:p((()=>[r(c(d),{style:{width:"100%"},type:"primary",onClick:Be},{default:p((()=>[g("Save")])),_:1})])),_:1})])),_:1})])),default:p((()=>[u("div",J,[r(c(x),{icon:"ant-design:setting-outlined",class:"cursor-pointer"})])])),_:1})])),_:1}),"asset"==a.index?(i(),y(c(V),{key:0,span:2,style:{display:"flex","align-items":"center"}},{default:p((()=>[u("div",G,[u("div",{class:j(["segment",{active:"tableSegment"===se.activeSegment}]),onClick:t[5]||(t[5]=e=>We("tableSegment"))},[r(c(v),null,{default:p((()=>[r(c(Ke))])),_:1})],2),u("div",{class:j(["segment",{active:"cardSegment"===se.activeSegment}]),onClick:t[6]||(t[6]=e=>We("cardSegment"))},[r(c(v),null,{default:p((()=>[r(c(Pe))])),_:1})],2)])])),_:1})):_("",!0),r(c(V),{span:2,xs:2,sm:2,md:2},{default:p((()=>["SensitiveResult"==a.index?(i(),y(c(d),{key:0,type:"success",onClick:a.$props.openAggregation,icon:c(ye)},{default:p((()=>[g(m(c(te)("project.aggregation")),1)])),_:1},8,["onClick","icon"])):_("",!0)])),_:1})])),_:1}),r(c(C),{style:{"margin-top":"10px"}},{default:p((()=>[r(c(V),{span:24},{default:p((()=>[u("div",X,[u("span",Y,m(c(te)("asset.total")),1),u("span",Z,m(se.searchResultCount),1),u("span",ee,m(c(te)("asset.result")),1),(i(!0),n(f,null,h(De.value,(e=>(i(),y(c($),{key:e,closable:"","disable-transitions":!1,type:"info",size:"small",onClose:a=>function(e){e.includes("task=")&&(Ue=""),se.handleClose&&se.handleClose(e)}(e)},{default:p((()=>[e.startsWith("icon=")?(i(),n("img",{key:0,src:"/images/icon/"+e.split("=")[1]+".png",alt:e,style:{width:"20px",height:"20px","vertical-align":"middle"}},null,8,ae)):(i(),n(f,{key:1},[g(m(e),1)],64))])),_:2},1032,["onClose"])))),128))])])),_:1})])),_:1})])),_:1}),r(c(N),{modelValue:ce.value,"onUpdate:modelValue":t[7]||(t[7]=e=>ce.value=e),title:c(te)("common.querysyntax"),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(c(C),null,{default:p((()=>[r(c(V),null,{default:p((()=>[r(c(E),{tag:"b",size:"small"},{default:p((()=>[g(m(c(te)("searchHelp.operator")),1)])),_:1}),r(c(T),{direction:"vertical"}),r(c(E),{size:"small",type:"danger"},{default:p((()=>[g(m(c(te)("searchHelp.notice")),1)])),_:1})])),_:1}),r(c(V),{style:{"margin-top":"10px"}},{default:p((()=>[r(c(H),{headerCellStyle:ue,data:c(pe)},{default:p((()=>[r(c(F),{prop:"operator",label:c(te)("searchHelp.operator"),width:"300"},null,8,["label"]),r(c(F),{prop:"meaning",label:c(te)("searchHelp.meaning")},null,8,["label"])])),_:1},8,["data"])])),_:1}),r(c(V),{style:{"margin-top":"15px"}},{default:p((()=>[r(c(E),{tag:"b",size:"small"},{default:p((()=>[g(m(c(te)("searchHelp.keywords")),1)])),_:1})])),_:1}),r(c(V),{style:{"margin-top":"10px"}},{default:p((()=>[r(c(H),{headerCellStyle:ue,data:oe},{default:p((()=>[r(c(F),{prop:"keyword",label:c(te)("searchHelp.keywords")},null,8,["label"]),r(c(F),{prop:"example",label:c(te)("searchHelp.example")},null,8,["label"]),r(c(F),{prop:"explain",label:c(te)("searchHelp.explain")},null,8,["label"])])),_:1},8,["data"])])),_:1})])),_:1})])),_:1},8,["modelValue","title"]),r(c(N),{modelValue:je.value,"onUpdate:modelValue":t[8]||(t[8]=e=>je.value=e),title:c(te)("asset.export"),center:"","max-height":"300",width:"70%",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(R,{index:a.$props.index,searchParams:me.value,getFilter:a.$props.getFilter},null,8,["index","searchParams","getFilter"])])),_:1},8,["modelValue","title"]),r(c(N),{modelValue:Je.value,"onUpdate:modelValue":t[9]||(t[9]=e=>Je.value=e),title:c(qe),center:"",style:{"border-radius":"15px","box-shadow":"5px 5px 10px rgba(0, 0, 0, 0.3)"}},{default:p((()=>[r(K,{closeDialog:Me,create:!0,taskid:"",schedule:!1,getList:function(){},tp:a.$props.index+"Source","target-ids":ke.value,getFilter:a.$props.getFilter,searchParams:me.value},null,8,["getList","tp","target-ids","getFilter","searchParams"])])),_:1},8,["modelValue","title"])],64))}}),[["__scopeId","data-v-179466d8"]]);export{te as default};
